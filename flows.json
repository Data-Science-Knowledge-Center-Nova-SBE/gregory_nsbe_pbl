[
    {
        "id": "08b45a8525563f9d",
        "type": "tab",
        "label": "RSS sources",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "2428494105fda90c",
        "type": "tab",
        "label": "APTA",
        "disabled": false,
        "info": ""
    },
    {
        "id": "88ae15c6d256f5d4",
        "type": "tab",
        "label": "BioMed Central",
        "disabled": false,
        "info": ""
    },
    {
        "id": "c08a9edc23457ee5",
        "type": "tab",
        "label": "PEDro",
        "disabled": false,
        "info": ""
    },
    {
        "id": "9117aa25f53ac397",
        "type": "tab",
        "label": "Scielo",
        "disabled": false,
        "info": ""
    },
    {
        "id": "71a6f3392a4b5c6a",
        "type": "tab",
        "label": "The Lancet",
        "disabled": false,
        "info": ""
    },
    {
        "id": "e805a8e0f0267c24",
        "type": "tab",
        "label": "JNeuroSci",
        "disabled": false,
        "info": ""
    },
    {
        "id": "390b6f59c14b2f84",
        "type": "tab",
        "label": "MS and Rel. Disorders",
        "disabled": false,
        "info": ""
    },
    {
        "id": "6143695246b35bf7",
        "type": "tab",
        "label": "Faseb",
        "disabled": false,
        "info": "[https://faseb.onlinelibrary.wiley.com/action/doSearch?field1=AllField&text1=Multiple+Sclerosis+OR+autoimmune+encephalomyelitis+OR+encephalomyelitis+OR+immune+tolerance+OR+myelin&field2=AllField&text2=&field3=AllField&text3=&publication%5B%5D=15306860&Ppub=](https://faseb.onlinelibrary.wiley.com/action/doSearch?field1=AllField&text1=Multiple+Sclerosis+OR+autoimmune+encephalomyelitis+OR+encephalomyelitis+OR+immune+tolerance+OR+myelin&field2=AllField&text2=&field3=AllField&text3=&publication%5B%5D=15306860&Ppub=)\n\n"
    },
    {
        "id": "0e63a1d341727118",
        "type": "tab",
        "label": "Clinical Trials",
        "disabled": false,
        "info": ""
    },
    {
        "id": "ed1d968f509a241a",
        "type": "tab",
        "label": "API",
        "disabled": false,
        "info": ""
    },
    {
        "id": "725b288ad1226693",
        "type": "tab",
        "label": "Email Digest",
        "disabled": false,
        "info": ""
    },
    {
        "id": "3645fb833bf0fede",
        "type": "tab",
        "label": "Machine Learning",
        "disabled": false,
        "info": ""
    },
    {
        "id": "96ed7d399250eb68",
        "type": "tab",
        "label": "Twitter",
        "disabled": false,
        "info": ""
    },
    {
        "id": "73dc69858609cde2",
        "type": "tab",
        "label": "tests",
        "disabled": false,
        "info": ""
    },
    {
        "id": "27add5de02c88e84",
        "type": "tab",
        "label": "Contact form",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "ab2553788bcfd4e4",
        "type": "tab",
        "label": "DB Maintenance",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "b86ce62c06906565",
        "type": "tab",
        "label": "!Journals.SagePub (not working)",
        "disabled": true,
        "info": ""
    },
    {
        "id": "acf883d8.84eea",
        "type": "subflow",
        "name": "Create SQL Command",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "4bb1f0128ef44676"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 680,
                "y": 80,
                "wires": [
                    {
                        "id": "59574bf17a15a7fa",
                        "port": 0
                    },
                    {
                        "id": "af433e25c31a9cab",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "d353eec5835441c0",
        "type": "subflow",
        "name": "throttle requests",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 120,
                "y": 160,
                "wires": [
                    {
                        "id": "eb444d3ffa4f324c"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 660,
                "y": 160,
                "wires": [
                    {
                        "id": "d5716d48a6a85ee3",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "822a1abe384d181e",
        "type": "subflow",
        "name": "Add to DB",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "eb49695acf2247b5"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 540,
                "y": 80,
                "wires": [
                    {
                        "id": "948d3c8c302e2380",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "73e7742c5dcd5260",
        "type": "group",
        "z": "3645fb833bf0fede",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "2423fda83c547982",
            "2f5030f323b8b823",
            "359543a807cae46a",
            "7662c7bb58cc6bb1",
            "402c42b3d9b92524",
            "3cd3c17a6de731d3",
            "e33b69b3a1d02f35",
            "508f690c259db91d",
            "e9cf7800e5bd2027",
            "3ed1ccd784978698",
            "48da5fa9cbf7b652",
            "930cf22afddf0c30"
        ],
        "x": 14,
        "y": 519
    },
    {
        "id": "e3876559.c845b8",
        "type": "tls-config",
        "name": "",
        "cert": "",
        "key": "",
        "ca": "",
        "certname": "node-cert.pem",
        "keyname": "node-key.pem",
        "caname": "",
        "servername": "",
        "verifyservercert": true
    },
    {
        "id": "9ccc1658.e12858",
        "type": "sqlitedb",
        "db": "/data/gregory.db",
        "mode": "RWC"
    },
    {
        "id": "58fc87aecc126c39",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "168f4567fd86d95c",
        "type": "postgresdb",
        "cfgname": "",
        "hostname": "db",
        "port": "5432",
        "db": "gregorybackoffice",
        "ssl": false
    },
    {
        "id": "59574bf17a15a7fa",
        "type": "template",
        "z": "acf883d8.84eea",
        "name": "msg.payload",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "INSERT INTO \"public\".\"articles\" (discovery_date,title,summary,link,published_date,source,relevant)\nVALUES (current_timestamp,'{{article.title}}','{{article.description}}','{{{article.url}}}',{{article.pubdate}},{{source}},NULL);",
        "output": "str",
        "x": 550,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "4bb1f0128ef44676",
        "type": "switch",
        "z": "acf883d8.84eea",
        "name": "",
        "property": "article.pubdate",
        "propertyType": "msg",
        "rules": [
            {
                "t": "empty"
            },
            {
                "t": "nempty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 150,
        "y": 80,
        "wires": [
            [
                "a37c5f2ed9b343c9"
            ],
            [
                "af433e25c31a9cab"
            ]
        ]
    },
    {
        "id": "a37c5f2ed9b343c9",
        "type": "change",
        "z": "acf883d8.84eea",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "article.pubdate",
                "pt": "msg",
                "to": "NULL",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 60,
        "wires": [
            [
                "59574bf17a15a7fa"
            ]
        ]
    },
    {
        "id": "af433e25c31a9cab",
        "type": "template",
        "z": "acf883d8.84eea",
        "name": "msg.payload",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "INSERT INTO \"public\".\"articles\" (discovery_date,title,summary,link,published_date,source,relevant)\nVALUES (current_timestamp,'{{article.title}}','{{article.description}}','{{{article.url}}}','{{article.pubdate}}',{{source}},NULL);",
        "output": "str",
        "x": 550,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "d5716d48a6a85ee3",
        "type": "delay",
        "z": "d353eec5835441c0",
        "name": "",
        "pauseType": "rate",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": true,
        "outputs": 1,
        "x": 490,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "eb444d3ffa4f324c",
        "type": "change",
        "z": "d353eec5835441c0",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "rate",
                "pt": "msg",
                "to": "200",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 320,
        "y": 160,
        "wires": [
            [
                "d5716d48a6a85ee3"
            ]
        ]
    },
    {
        "id": "eb49695acf2247b5",
        "type": "delay",
        "z": "822a1abe384d181e",
        "name": "",
        "pauseType": "random",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "200",
        "randomLast": "300",
        "randomUnits": "milliseconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 200,
        "y": 80,
        "wires": [
            [
                "948d3c8c302e2380"
            ]
        ]
    },
    {
        "id": "948d3c8c302e2380",
        "type": "sqlite",
        "z": "822a1abe384d181e",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 370,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "28ba7ee438cbcfa4",
        "type": "inject",
        "z": "08b45a8525563f9d",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "3600",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 200,
        "y": 80,
        "wires": [
            [
                "178d96d209f1f2eb"
            ]
        ]
    },
    {
        "id": "178d96d209f1f2eb",
        "type": "exec",
        "z": "08b45a8525563f9d",
        "command": "/usr/bin/python3 /python-ml/feedreader.py",
        "addpay": "",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 460,
        "y": 80,
        "wires": [
            [
                "1e0c96573eaa60c6"
            ],
            [
                "1e0c96573eaa60c6"
            ],
            [
                "1e0c96573eaa60c6"
            ]
        ]
    },
    {
        "id": "1e0c96573eaa60c6",
        "type": "debug",
        "z": "08b45a8525563f9d",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 730,
        "y": 80,
        "wires": []
    },
    {
        "id": "11b8ea1012c059c3",
        "type": "inject",
        "z": "2428494105fda90c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "1",
                "vt": "num"
            }
        ],
        "repeat": "10800",
        "crontab": "",
        "once": true,
        "onceDelay": "30",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 80,
        "wires": [
            [
                "de69a70f8fb4022f"
            ]
        ]
    },
    {
        "id": "de69a70f8fb4022f",
        "type": "http request",
        "z": "2428494105fda90c",
        "name": "APTA",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://www.apta.org/search?Q=%22Multiple+Sclerosis%22+OR+%22autoimmune+encephalomyelitis%22+OR+encephalomyelitis+OR+%22immune+tolerance%22+OR+myelin&searcharticletypes=8834&searchconditionandsymptoms=&searchloc=APTA",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 130,
        "y": 140,
        "wires": [
            [
                "1f0804a52a890a23"
            ]
        ]
    },
    {
        "id": "04f462c5419e5a76",
        "type": "change",
        "z": "2428494105fda90c",
        "name": "set source APTA",
        "rules": [
            {
                "t": "set",
                "p": "article",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article.url",
                "pt": "msg",
                "to": "\"https://www.apta.org\" & payload.link",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.pubdate",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 220,
        "wires": [
            [
                "00b48ed8ce42c514"
            ]
        ]
    },
    {
        "id": "00b48ed8ce42c514",
        "type": "subflow:acf883d8.84eea",
        "z": "2428494105fda90c",
        "name": "",
        "env": [],
        "x": 600,
        "y": 220,
        "wires": [
            [
                "596ddca45875969d"
            ]
        ]
    },
    {
        "id": "ab74966c1a4faf47",
        "type": "split",
        "z": "2428494105fda90c",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 510,
        "y": 140,
        "wires": [
            [
                "04f462c5419e5a76"
            ]
        ]
    },
    {
        "id": "1f0804a52a890a23",
        "type": "cheerio",
        "z": "2428494105fda90c",
        "name": "",
        "tag": "div.mg-n40px div.mb-40px",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "a",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            },
            {
                "search": "p + p",
                "ret": "text",
                "replace": "description",
                "attr": ""
            },
            {
                "search": "p.text-uppercase.text-muted.ff-apta-sans.fw-600.fs-14px",
                "ret": "text",
                "replace": "pubdate",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 320,
        "y": 140,
        "wires": [
            [
                "ab74966c1a4faf47"
            ]
        ]
    },
    {
        "id": "1191c9efc88c9280",
        "type": "meta",
        "z": "2428494105fda90c",
        "name": "meta",
        "x": 250,
        "y": 600,
        "wires": [
            [
                "78cd0d30253ae699"
            ]
        ]
    },
    {
        "id": "f0a1a040b12c1177",
        "type": "change",
        "z": "2428494105fda90c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "article_id",
                "pt": "msg",
                "to": "payload.article_id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.link",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 520,
        "wires": [
            [
                "1191c9efc88c9280"
            ]
        ]
    },
    {
        "id": "78cd0d30253ae699",
        "type": "moment",
        "z": "2428494105fda90c",
        "name": "",
        "topic": "",
        "input": "payload[\"article:published_time\"]",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "POSIX",
        "output": "datetime",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 420,
        "y": 600,
        "wires": [
            [
                "5c5620f98e2373d5"
            ]
        ]
    },
    {
        "id": "5c5620f98e2373d5",
        "type": "template",
        "z": "2428494105fda90c",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "update articles set published_date ='{{datetime}}' where article_id  = {{article_id}};",
        "output": "str",
        "x": 600,
        "y": 600,
        "wires": [
            [
                "81296b01c8171d0a"
            ]
        ]
    },
    {
        "id": "f35bfdcb0c6b6be0",
        "type": "comment",
        "z": "2428494105fda90c",
        "name": "populate missing values of published date",
        "info": "",
        "x": 200,
        "y": 460,
        "wires": []
    },
    {
        "id": "596ddca45875969d",
        "type": "postgres",
        "z": "2428494105fda90c",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 780,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "3e6cbadb897b98e8",
        "type": "inject",
        "z": "2428494105fda90c",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "1",
                "vt": "num"
            }
        ],
        "repeat": "7200",
        "crontab": "",
        "once": true,
        "onceDelay": "180",
        "topic": "",
        "payload": "select article_id,link from articles where source = 1 and published_date is null order by article_id desc limit 10;",
        "payloadType": "str",
        "x": 110,
        "y": 520,
        "wires": [
            [
                "32c6732fa2c38f0c"
            ]
        ]
    },
    {
        "id": "32c6732fa2c38f0c",
        "type": "postgres",
        "z": "2428494105fda90c",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 240,
        "y": 520,
        "wires": [
            [
                "4a972fe5b205f42e"
            ]
        ]
    },
    {
        "id": "4a972fe5b205f42e",
        "type": "split",
        "z": "2428494105fda90c",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 370,
        "y": 520,
        "wires": [
            [
                "6146a3ed6a3aecbe"
            ]
        ]
    },
    {
        "id": "81296b01c8171d0a",
        "type": "postgres",
        "z": "2428494105fda90c",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 760,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "6146a3ed6a3aecbe",
        "type": "delay",
        "z": "2428494105fda90c",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 530,
        "y": 520,
        "wires": [
            [
                "f0a1a040b12c1177"
            ]
        ]
    },
    {
        "id": "ce9e811e7045c057",
        "type": "inject",
        "z": "88ae15c6d256f5d4",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "source",
                "v": "2",
                "vt": "num"
            }
        ],
        "repeat": "7200",
        "crontab": "",
        "once": true,
        "onceDelay": "30",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 60,
        "wires": [
            [
                "233d527b4ab43de1"
            ]
        ]
    },
    {
        "id": "233d527b4ab43de1",
        "type": "http request",
        "z": "88ae15c6d256f5d4",
        "name": "BioMedCentral",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://www.biomedcentral.com/search?searchType=publisherSearch&sort=PubDate&page=1&query=Multiple+Sclerosis",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 300,
        "y": 60,
        "wires": [
            [
                "eb38cb7b17696e2e"
            ]
        ]
    },
    {
        "id": "ac0e3f75a9d65c2c",
        "type": "change",
        "z": "88ae15c6d256f5d4",
        "name": "set source BioMedCentral",
        "rules": [
            {
                "t": "set",
                "p": "article.url",
                "pt": "msg",
                "to": "\"https:\" & payload.link",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.source",
                "pt": "msg",
                "to": "BioMedCentral",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "article.description",
                "pt": "msg",
                "to": "$trim(article.description)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.title",
                "pt": "msg",
                "to": "$trim(article.title)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 570,
        "y": 200,
        "wires": [
            [
                "3c020dec37823b86"
            ]
        ]
    },
    {
        "id": "8aadc418e9703347",
        "type": "split",
        "z": "88ae15c6d256f5d4",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 370,
        "y": 120,
        "wires": [
            [
                "a376ec8bc344cec4"
            ]
        ]
    },
    {
        "id": "3c020dec37823b86",
        "type": "subflow:acf883d8.84eea",
        "z": "88ae15c6d256f5d4",
        "name": "Insert SQL",
        "env": [],
        "x": 370,
        "y": 260,
        "wires": [
            [
                "84b76d74a66f2e48"
            ]
        ]
    },
    {
        "id": "eb38cb7b17696e2e",
        "type": "cheerio",
        "z": "88ae15c6d256f5d4",
        "name": "",
        "tag": "li.c-list-group__item",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "h3.c-listing__title",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "a[itemprop=\"url\"]",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            },
            {
                "search": "p.c-listing__text",
                "ret": "text",
                "replace": "description",
                "attr": ""
            },
            {
                "search": "span[itemprop=\"datePublished\"]",
                "ret": "text",
                "replace": "pubdate",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 500,
        "y": 60,
        "wires": [
            [
                "8aadc418e9703347"
            ]
        ]
    },
    {
        "id": "a376ec8bc344cec4",
        "type": "switch",
        "z": "88ae15c6d256f5d4",
        "name": "",
        "property": "payload.title",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 490,
        "y": 120,
        "wires": [
            [
                "df80ccf83e124217"
            ]
        ]
    },
    {
        "id": "df80ccf83e124217",
        "type": "change",
        "z": "88ae15c6d256f5d4",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "article",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 120,
        "wires": [
            [
                "8d76351255f85895"
            ]
        ]
    },
    {
        "id": "8d76351255f85895",
        "type": "moment",
        "z": "88ae15c6d256f5d4",
        "name": "format pubdate",
        "topic": "",
        "input": "payload.pubdate",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "en-US",
        "output": "article.pubdate",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 340,
        "y": 200,
        "wires": [
            [
                "ac0e3f75a9d65c2c"
            ]
        ]
    },
    {
        "id": "84b76d74a66f2e48",
        "type": "postgres",
        "z": "88ae15c6d256f5d4",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 540,
        "y": 260,
        "wires": [
            [
                "808eb1f7d13c78dc"
            ]
        ]
    },
    {
        "id": "808eb1f7d13c78dc",
        "type": "debug",
        "z": "88ae15c6d256f5d4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 700,
        "y": 260,
        "wires": []
    },
    {
        "id": "5a02759466b2bdb4",
        "type": "http request",
        "z": "c08a9edc23457ee5",
        "name": "PEDro",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://search.pedro.org.au/advanced-search/results?abstract_with_title=Multiple+Sclerosis&therapy=0&problem=0&body_part=0&subdiscipline=0&topic=0&method=0&authors_association=&title=&source=&year_of_publication=&date_record_was_created=&nscore=&perpage=20&lop=or&find=&find=Start+Search",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 290,
        "y": 80,
        "wires": [
            [
                "c04aaf4a94b5d986"
            ]
        ]
    },
    {
        "id": "1fcc0ac17bc0723d",
        "type": "split",
        "z": "c08a9edc23457ee5",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 430,
        "y": 160,
        "wires": [
            [
                "c8651728aaf957d1"
            ]
        ]
    },
    {
        "id": "99751a0fa9dd6206",
        "type": "change",
        "z": "c08a9edc23457ee5",
        "name": "set source PEDro",
        "rules": [
            {
                "t": "set",
                "p": "article",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article.url",
                "pt": "msg",
                "to": "payload.link",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.source",
                "pt": "msg",
                "to": "PEDro",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "article.description",
                "pt": "msg",
                "to": "not available",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "article.title",
                "pt": "msg",
                "to": "$trim(article.title)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 220,
        "wires": [
            [
                "bdcb3324bf58ea32"
            ]
        ]
    },
    {
        "id": "bdcb3324bf58ea32",
        "type": "subflow:acf883d8.84eea",
        "z": "c08a9edc23457ee5",
        "name": "Insert SQL",
        "env": [],
        "x": 610,
        "y": 220,
        "wires": [
            [
                "0a616c3fbbef6640"
            ]
        ]
    },
    {
        "id": "b3f913e00616c676",
        "type": "inject",
        "z": "c08a9edc23457ee5",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "7",
                "vt": "num"
            }
        ],
        "repeat": "13200",
        "crontab": "",
        "once": true,
        "onceDelay": "300",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 80,
        "wires": [
            [
                "5a02759466b2bdb4"
            ]
        ]
    },
    {
        "id": "c04aaf4a94b5d986",
        "type": "cheerio",
        "z": "c08a9edc23457ee5",
        "name": "",
        "tag": "table.search-results tr",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "td>a",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "td>a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            },
            {
                "search": "p.NoSummary",
                "ret": "text",
                "replace": "description",
                "attr": ""
            },
            {
                "search": "p.NoDate",
                "ret": "text",
                "replace": "pubdate",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 260,
        "y": 160,
        "wires": [
            [
                "1fcc0ac17bc0723d"
            ]
        ]
    },
    {
        "id": "c8651728aaf957d1",
        "type": "moment",
        "z": "c08a9edc23457ee5",
        "name": "format pubdate",
        "topic": "",
        "input": "payload.pubdate",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "en-US",
        "output": "article.pubdate",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 220,
        "y": 220,
        "wires": [
            [
                "99751a0fa9dd6206"
            ]
        ]
    },
    {
        "id": "1f89bd7bea9b9b55",
        "type": "inject",
        "z": "c08a9edc23457ee5",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "7",
                "vt": "num"
            }
        ],
        "repeat": "3600",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "SELECT * FROM articles  WHERE source = 7 AND summary ='not available' ;",
        "payloadType": "str",
        "x": 110,
        "y": 380,
        "wires": [
            [
                "72d5badde9ad7709"
            ]
        ]
    },
    {
        "id": "60cc82f5067a2031",
        "type": "comment",
        "z": "c08a9edc23457ee5",
        "name": "ADD PEDro SUMMARY",
        "info": "",
        "x": 160,
        "y": 340,
        "wires": []
    },
    {
        "id": "2bed8fe32e67f84f",
        "type": "split",
        "z": "c08a9edc23457ee5",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 370,
        "y": 380,
        "wires": [
            [
                "cec1aa0f6080932a"
            ]
        ]
    },
    {
        "id": "4890bb4b1509d5fd",
        "type": "http request",
        "z": "c08a9edc23457ee5",
        "name": "PEDro",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 790,
        "y": 380,
        "wires": [
            [
                "4ac76aa4261adadf"
            ]
        ]
    },
    {
        "id": "52a015cdfb761ab1",
        "type": "change",
        "z": "c08a9edc23457ee5",
        "name": "set fields",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "payload.link",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article_id",
                "pt": "msg",
                "to": "payload.article_id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "rejectUnauthorized",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 660,
        "y": 380,
        "wires": [
            [
                "4890bb4b1509d5fd"
            ]
        ]
    },
    {
        "id": "cec1aa0f6080932a",
        "type": "delay",
        "z": "c08a9edc23457ee5",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 510,
        "y": 380,
        "wires": [
            [
                "52a015cdfb761ab1"
            ]
        ]
    },
    {
        "id": "8bf6f22733e79b31",
        "type": "split",
        "z": "c08a9edc23457ee5",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 770,
        "y": 460,
        "wires": [
            [
                "a1881ada0ab9ef89"
            ]
        ]
    },
    {
        "id": "4ac76aa4261adadf",
        "type": "cheerio",
        "z": "c08a9edc23457ee5",
        "name": "",
        "tag": "#search-content > table > tbody",
        "ret": "text",
        "as": "single",
        "map": [
            {
                "search": "",
                "ret": "text",
                "replace": "",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": false,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 550,
        "y": 460,
        "wires": [
            [
                "8bf6f22733e79b31"
            ]
        ]
    },
    {
        "id": "0a616c3fbbef6640",
        "type": "postgres",
        "z": "c08a9edc23457ee5",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 760,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "72d5badde9ad7709",
        "type": "postgres",
        "z": "c08a9edc23457ee5",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 240,
        "y": 380,
        "wires": [
            [
                "2bed8fe32e67f84f"
            ]
        ]
    },
    {
        "id": "9c2ed0cec2c29944",
        "type": "postgres",
        "z": "c08a9edc23457ee5",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": false,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": false,
        "x": 940,
        "y": 500,
        "wires": []
    },
    {
        "id": "a1881ada0ab9ef89",
        "type": "string",
        "z": "c08a9edc23457ee5",
        "name": "",
        "methods": [
            {
                "name": "trim",
                "params": []
            },
            {
                "name": "collapseWhitespace",
                "params": []
            }
        ],
        "prop": "payload",
        "propout": "payload",
        "object": "msg",
        "objectout": "msg",
        "x": 470,
        "y": 500,
        "wires": [
            [
                "19723e1ea72d2153"
            ]
        ]
    },
    {
        "id": "19723e1ea72d2153",
        "type": "change",
        "z": "c08a9edc23457ee5",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$replace(payload, \"'\", \"''\")\t",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 630,
        "y": 500,
        "wires": [
            [
                "480d5f0716e9812b"
            ]
        ]
    },
    {
        "id": "480d5f0716e9812b",
        "type": "template",
        "z": "c08a9edc23457ee5",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "UPDATE articles\nset summary = '{{{payload}}}'\nwhere article_id = {{article_id}};",
        "output": "str",
        "x": 800,
        "y": 500,
        "wires": [
            [
                "9c2ed0cec2c29944"
            ]
        ]
    },
    {
        "id": "ef2d64651221bf15",
        "type": "http request",
        "z": "9117aa25f53ac397",
        "name": "Scielo.org",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://search.scielo.org/?q=Multiple+Sclerosis&lang=en&count=15&from=0&output=site&sort=&format=summary&fb=&page=1&q=%22Multiple+Sclerosis%22+OR+%22autoimmune+encephalomyelitis%22+OR+encephalomyelitis+OR+%22immune+tolerance%22+OR+myelin&lang=en&page=1",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 280,
        "y": 100,
        "wires": [
            [
                "03dae7408cafeacb"
            ]
        ]
    },
    {
        "id": "5479e9144a73486e",
        "type": "inject",
        "z": "9117aa25f53ac397",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "10",
                "vt": "num"
            }
        ],
        "repeat": "14400",
        "crontab": "",
        "once": true,
        "onceDelay": "30",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 100,
        "wires": [
            [
                "ef2d64651221bf15"
            ]
        ]
    },
    {
        "id": "306fa0ce34864944",
        "type": "split",
        "z": "9117aa25f53ac397",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 650,
        "y": 100,
        "wires": [
            [
                "b92ce4dbbab2c97f"
            ]
        ]
    },
    {
        "id": "a4bdec9593e289cd",
        "type": "change",
        "z": "9117aa25f53ac397",
        "name": "set source Scielo",
        "rules": [
            {
                "t": "set",
                "p": "article",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article.url",
                "pt": "msg",
                "to": "payload.link",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.source",
                "pt": "msg",
                "to": "Scielo",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "article.description",
                "pt": "msg",
                "to": "$trim(article.description)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.title",
                "pt": "msg",
                "to": "$trim(article.title)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 330,
        "y": 160,
        "wires": [
            [
                "40014ec5a78fd09b"
            ]
        ]
    },
    {
        "id": "40014ec5a78fd09b",
        "type": "subflow:acf883d8.84eea",
        "z": "9117aa25f53ac397",
        "name": "Insert SQL",
        "env": [],
        "x": 510,
        "y": 160,
        "wires": [
            [
                "04dd9e1fe9e8b4ca"
            ]
        ]
    },
    {
        "id": "03dae7408cafeacb",
        "type": "cheerio",
        "z": "9117aa25f53ac397",
        "name": "",
        "tag": "div.results div.item",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "strong.title",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "div.line a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            },
            {
                "search": "p.NoSummary",
                "ret": "text",
                "replace": "description",
                "attr": ""
            },
            {
                "search": "p.NoDate",
                "ret": "text",
                "replace": "pubdate",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 470,
        "y": 100,
        "wires": [
            [
                "306fa0ce34864944"
            ]
        ]
    },
    {
        "id": "b92ce4dbbab2c97f",
        "type": "moment",
        "z": "9117aa25f53ac397",
        "name": "format pubdate",
        "topic": "",
        "input": "payload.pubdate",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "en-US",
        "output": "article.pubdate",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 140,
        "y": 160,
        "wires": [
            [
                "a4bdec9593e289cd"
            ]
        ]
    },
    {
        "id": "f4dc55d7a235d105",
        "type": "inject",
        "z": "9117aa25f53ac397",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "10",
                "vt": "num"
            }
        ],
        "repeat": "7200",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "SELECT * FROM articles  WHERE source = 10 AND summary ='not available' OR summary is null OR summary = '';",
        "payloadType": "str",
        "x": 130,
        "y": 320,
        "wires": [
            [
                "7a81ee11942a97b2"
            ]
        ]
    },
    {
        "id": "86514554015d66fb",
        "type": "comment",
        "z": "9117aa25f53ac397",
        "name": "ADD Scielo SUMMARY",
        "info": "",
        "x": 150,
        "y": 280,
        "wires": []
    },
    {
        "id": "d503582027fa519c",
        "type": "split",
        "z": "9117aa25f53ac397",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 450,
        "y": 320,
        "wires": [
            [
                "68c16ec10e5c5a67"
            ]
        ]
    },
    {
        "id": "b7f1533c9c7285c8",
        "type": "http request",
        "z": "9117aa25f53ac397",
        "name": "Scielo",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 110,
        "y": 400,
        "wires": [
            [
                "5150d74983127a60"
            ]
        ]
    },
    {
        "id": "216854b46cda11b8",
        "type": "change",
        "z": "9117aa25f53ac397",
        "name": "set fields",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "payload.link",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article_id",
                "pt": "msg",
                "to": "payload.article_id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "rejectUnauthorized",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 760,
        "y": 320,
        "wires": [
            [
                "b7f1533c9c7285c8"
            ]
        ]
    },
    {
        "id": "5150d74983127a60",
        "type": "html",
        "z": "9117aa25f53ac397",
        "name": "",
        "property": "payload",
        "outproperty": "payload",
        "tag": "meta",
        "ret": "attr",
        "as": "multi",
        "x": 240,
        "y": 400,
        "wires": [
            [
                "5915f63c7dc57e55"
            ]
        ]
    },
    {
        "id": "5915f63c7dc57e55",
        "type": "switch",
        "z": "9117aa25f53ac397",
        "name": "",
        "property": "payload.name",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "citation_abstract",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 390,
        "y": 400,
        "wires": [
            [
                "82fdd9d4fb6f19ae"
            ]
        ]
    },
    {
        "id": "15d6537fa1ad0028",
        "type": "template",
        "z": "9117aa25f53ac397",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "UPDATE articles\nset summary = '{{{payload.content}}}'\nwhere article_id = {{article_id}};",
        "output": "str",
        "x": 760,
        "y": 400,
        "wires": [
            [
                "377ad920924006ae"
            ]
        ]
    },
    {
        "id": "68c16ec10e5c5a67",
        "type": "delay",
        "z": "9117aa25f53ac397",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "60",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 600,
        "y": 320,
        "wires": [
            [
                "216854b46cda11b8"
            ]
        ]
    },
    {
        "id": "c91d666280429ad6",
        "type": "debug",
        "z": "9117aa25f53ac397",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 570,
        "y": 760,
        "wires": []
    },
    {
        "id": "3202ea000da86c52",
        "type": "meta",
        "z": "9117aa25f53ac397",
        "name": "meta",
        "x": 990,
        "y": 540,
        "wires": [
            [
                "a6b3997111e002d0"
            ]
        ]
    },
    {
        "id": "5f731057cd1e1809",
        "type": "change",
        "z": "9117aa25f53ac397",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "article_id",
                "pt": "msg",
                "to": "payload.article_id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.link",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 820,
        "y": 540,
        "wires": [
            [
                "3202ea000da86c52"
            ]
        ]
    },
    {
        "id": "0476e69a8c64fbd9",
        "type": "moment",
        "z": "9117aa25f53ac397",
        "name": "",
        "topic": "",
        "input": "payload.citation_publication_date",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": "0",
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "POSIX",
        "output": "datetime",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 300,
        "y": 620,
        "wires": [
            [
                "fb6aca8cfa8bc6d9"
            ]
        ]
    },
    {
        "id": "fb6aca8cfa8bc6d9",
        "type": "template",
        "z": "9117aa25f53ac397",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "update articles set published_date ='{{datetime}}' where article_id  = {{article_id}};",
        "output": "str",
        "x": 480,
        "y": 620,
        "wires": [
            [
                "c91d666280429ad6",
                "20fac8dd717ded1c"
            ]
        ]
    },
    {
        "id": "4fdb9c66025d9bc1",
        "type": "comment",
        "z": "9117aa25f53ac397",
        "name": "populate missing values of published date",
        "info": "",
        "x": 220,
        "y": 480,
        "wires": []
    },
    {
        "id": "cfd86987042857fa",
        "type": "inject",
        "z": "9117aa25f53ac397",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "SELECT \tarticle_id, \tlink FROM \tarticles WHERE \tsource = 10 \tAND published_date IS NULL ORDER BY \tarticle_id DESC LIMIT 10;",
        "payloadType": "str",
        "x": 160,
        "y": 540,
        "wires": [
            [
                "b54b85d981dd431b"
            ]
        ]
    },
    {
        "id": "a6b3997111e002d0",
        "type": "switch",
        "z": "9117aa25f53ac397",
        "name": "",
        "property": "payload.citation_publication_date",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "empty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 90,
        "y": 620,
        "wires": [
            [
                "0476e69a8c64fbd9"
            ],
            [
                "c91d666280429ad6"
            ],
            [
                "aabf33de22a78dd0"
            ]
        ]
    },
    {
        "id": "12adbe5842aca085",
        "type": "split",
        "z": "9117aa25f53ac397",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 450,
        "y": 540,
        "wires": [
            [
                "adc59ef724a99fc9"
            ]
        ]
    },
    {
        "id": "adc59ef724a99fc9",
        "type": "delay",
        "z": "9117aa25f53ac397",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "minute",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 620,
        "y": 540,
        "wires": [
            [
                "5f731057cd1e1809"
            ]
        ]
    },
    {
        "id": "aabf33de22a78dd0",
        "type": "moment",
        "z": "9117aa25f53ac397",
        "name": "",
        "topic": "",
        "input": "payload.citation_date",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "POSIX",
        "output": "",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 260,
        "y": 760,
        "wires": [
            [
                "c91d666280429ad6"
            ]
        ]
    },
    {
        "id": "04dd9e1fe9e8b4ca",
        "type": "postgres",
        "z": "9117aa25f53ac397",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 700,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "7a81ee11942a97b2",
        "type": "postgres",
        "z": "9117aa25f53ac397",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 310,
        "y": 320,
        "wires": [
            [
                "d503582027fa519c"
            ]
        ]
    },
    {
        "id": "82fdd9d4fb6f19ae",
        "type": "change",
        "z": "9117aa25f53ac397",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.content",
                "pt": "msg",
                "to": "$replace(payload.content, \"'\", \"''\")\t",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 570,
        "y": 400,
        "wires": [
            [
                "15d6537fa1ad0028"
            ]
        ]
    },
    {
        "id": "377ad920924006ae",
        "type": "postgres",
        "z": "9117aa25f53ac397",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 900,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "b54b85d981dd431b",
        "type": "postgres",
        "z": "9117aa25f53ac397",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 300,
        "y": 540,
        "wires": [
            [
                "12adbe5842aca085"
            ]
        ]
    },
    {
        "id": "20fac8dd717ded1c",
        "type": "postgres",
        "z": "9117aa25f53ac397",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 680,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "d4ae26482cf5c298",
        "type": "http request",
        "z": "71a6f3392a4b5c6a",
        "name": "The Lancet",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://www.thelancet.com/action/doSearch?text1=%22Multiple+Sclerosis%22+OR+%22autoimmune+encephalomyelitis%22+OR+encephalomyelitis+OR+%22immune+tolerance%22+OR+myelin&field1=AbstractTitleKeywordFilterField&startPage=0&sortBy=Earliest",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 310,
        "y": 60,
        "wires": [
            [
                "cc613ceaa4c7fb40",
                "c6f3cbe30bfc42af"
            ]
        ]
    },
    {
        "id": "3ef4cd241aca1ed0",
        "type": "inject",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "11",
                "vt": "num"
            }
        ],
        "repeat": "10800",
        "crontab": "",
        "once": true,
        "onceDelay": "67",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 60,
        "wires": [
            [
                "d4ae26482cf5c298"
            ]
        ]
    },
    {
        "id": "d3738f3da21ad085",
        "type": "split",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 750,
        "y": 60,
        "wires": [
            [
                "e61b95543d713467"
            ]
        ]
    },
    {
        "id": "e61b95543d713467",
        "type": "change",
        "z": "71a6f3392a4b5c6a",
        "name": "set source The Lancet",
        "rules": [
            {
                "t": "set",
                "p": "article",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article.url",
                "pt": "msg",
                "to": "\"https://www.thelancet.com\" & payload.link",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.source",
                "pt": "msg",
                "to": "The Lancet",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "article.description",
                "pt": "msg",
                "to": "$trim(article.description)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.title",
                "pt": "msg",
                "to": "$trim(article.title)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.pubdate",
                "pt": "msg",
                "to": "$trim($replace(article.pubdate, \"Published: \", \" \"))",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 960,
        "y": 60,
        "wires": [
            [
                "15906d78b0cfe1c9"
            ]
        ]
    },
    {
        "id": "6d1c2697f5618142",
        "type": "subflow:acf883d8.84eea",
        "z": "71a6f3392a4b5c6a",
        "name": "Insert SQL",
        "env": [],
        "x": 1410,
        "y": 60,
        "wires": [
            [
                "f319df7c6315b98a"
            ]
        ]
    },
    {
        "id": "cc613ceaa4c7fb40",
        "type": "cheerio",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "tag": "div.search__item__body",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "h4.meta__title",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "h4.meta__title a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            },
            {
                "search": "p.NoSummary",
                "ret": "text",
                "replace": "description",
                "attr": ""
            },
            {
                "search": "p.meta__details > span:nth-child(5)",
                "ret": "text",
                "replace": "pubdate",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 550,
        "y": 60,
        "wires": [
            [
                "d3738f3da21ad085"
            ]
        ]
    },
    {
        "id": "15906d78b0cfe1c9",
        "type": "moment",
        "z": "71a6f3392a4b5c6a",
        "name": "format pubdate",
        "topic": "",
        "input": "payload.pubdate",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "en-US",
        "output": "article.pubdate",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 1200,
        "y": 60,
        "wires": [
            [
                "6d1c2697f5618142"
            ]
        ]
    },
    {
        "id": "e66c651a39def935",
        "type": "comment",
        "z": "71a6f3392a4b5c6a",
        "name": "ADD The Lancet SUMMARY",
        "info": "",
        "x": 160,
        "y": 360,
        "wires": []
    },
    {
        "id": "1ba9faed563df83f",
        "type": "split",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 430,
        "y": 460,
        "wires": [
            [
                "1982b1e77f224d9c"
            ]
        ]
    },
    {
        "id": "cc66f3e920445f22",
        "type": "http request",
        "z": "71a6f3392a4b5c6a",
        "name": "The Lancet",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 890,
        "y": 460,
        "wires": [
            [
                "e9a67345c52ef154"
            ]
        ]
    },
    {
        "id": "e9a67345c52ef154",
        "type": "html",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "property": "payload",
        "outproperty": "payload",
        "tag": "meta",
        "ret": "attr",
        "as": "multi",
        "x": 650,
        "y": 520,
        "wires": [
            [
                "c68b2c9c098e29c1"
            ]
        ]
    },
    {
        "id": "45337695619f942c",
        "type": "change",
        "z": "71a6f3392a4b5c6a",
        "name": "set fields",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "payload.link",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article_id",
                "pt": "msg",
                "to": "payload.article_id",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 740,
        "y": 460,
        "wires": [
            [
                "cc66f3e920445f22"
            ]
        ]
    },
    {
        "id": "c68b2c9c098e29c1",
        "type": "switch",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "property": "payload.name",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "citation_abstract",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 790,
        "y": 520,
        "wires": [
            [
                "f6f5cbf8e502ada2"
            ]
        ]
    },
    {
        "id": "1982b1e77f224d9c",
        "type": "delay",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "30",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 580,
        "y": 460,
        "wires": [
            [
                "45337695619f942c"
            ]
        ]
    },
    {
        "id": "c6f3cbe30bfc42af",
        "type": "debug",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 600,
        "y": 240,
        "wires": []
    },
    {
        "id": "057faeb7a45af411",
        "type": "change",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "article_id",
                "pt": "msg",
                "to": "payload.article_id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.link",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 140,
        "y": 720,
        "wires": [
            [
                "4753ba8ff06b8a6c"
            ]
        ]
    },
    {
        "id": "0733654d1109348a",
        "type": "template",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "update articles set published_date ='{{payload}}' where article_id  = {{article_id}};",
        "output": "str",
        "x": 440,
        "y": 780,
        "wires": [
            [
                "6c0136e7c086bc28"
            ]
        ]
    },
    {
        "id": "76558ac9139f1b6f",
        "type": "comment",
        "z": "71a6f3392a4b5c6a",
        "name": "populate missing values of published date. working",
        "info": "",
        "x": 230,
        "y": 560,
        "wires": []
    },
    {
        "id": "4753ba8ff06b8a6c",
        "type": "http request",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 310,
        "y": 720,
        "wires": [
            [
                "b1f3ead31d64683a"
            ]
        ]
    },
    {
        "id": "b1f3ead31d64683a",
        "type": "cheerio",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "tag": "span.article-header__publish-date__value",
        "ret": "html",
        "as": "single",
        "map": [
            {
                "search": "",
                "ret": "text",
                "replace": "published_date",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": false,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 580,
        "y": 720,
        "wires": [
            [
                "1ca31e0d40e8ac01"
            ]
        ]
    },
    {
        "id": "1ca31e0d40e8ac01",
        "type": "moment",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "topic": "",
        "input": "payload[0]",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "POSIX",
        "output": "",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 240,
        "y": 780,
        "wires": [
            [
                "0733654d1109348a"
            ]
        ]
    },
    {
        "id": "f319df7c6315b98a",
        "type": "postgres",
        "z": "71a6f3392a4b5c6a",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 1580,
        "y": 60,
        "wires": [
            [
                "a9e607b9e61c9eea"
            ]
        ]
    },
    {
        "id": "a9e607b9e61c9eea",
        "type": "debug",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1660,
        "y": 160,
        "wires": []
    },
    {
        "id": "766adcc1407e1039",
        "type": "inject",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "11",
                "vt": "num"
            }
        ],
        "repeat": "7200",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "SELECT * FROM articles  WHERE source = 11 AND summary ='not available' OR summary is null OR summary = '';",
        "payloadType": "str",
        "x": 110,
        "y": 460,
        "wires": [
            [
                "7096cfa9279fd7b1"
            ]
        ]
    },
    {
        "id": "7096cfa9279fd7b1",
        "type": "postgres",
        "z": "71a6f3392a4b5c6a",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 290,
        "y": 460,
        "wires": [
            [
                "1ba9faed563df83f"
            ]
        ]
    },
    {
        "id": "f6f5cbf8e502ada2",
        "type": "template",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "UPDATE articles\nset summary = '{{{payload.content}}}'\nwhere article_id = {{article_id}};",
        "output": "str",
        "x": 920,
        "y": 520,
        "wires": [
            [
                "9e758f4c38cc19d9"
            ]
        ]
    },
    {
        "id": "9e758f4c38cc19d9",
        "type": "postgres",
        "z": "71a6f3392a4b5c6a",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 1060,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "b7342d4d3f3c788a",
        "type": "inject",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "SELECT \tarticle_id, \tlink FROM \tarticles WHERE \tsource = 11 \tAND published_date IS NULL ORDER BY \tarticle_id DESC LIMIT 10;",
        "payloadType": "str",
        "x": 130,
        "y": 620,
        "wires": [
            [
                "dcd9bec2d81bff1e"
            ]
        ]
    },
    {
        "id": "dcd9bec2d81bff1e",
        "type": "postgres",
        "z": "71a6f3392a4b5c6a",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 280,
        "y": 620,
        "wires": [
            [
                "36b21015357e24a2"
            ]
        ]
    },
    {
        "id": "6c0136e7c086bc28",
        "type": "postgres",
        "z": "71a6f3392a4b5c6a",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": false,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": false,
        "x": 580,
        "y": 780,
        "wires": []
    },
    {
        "id": "70a03caf4fa6bdd9",
        "type": "delay",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "5",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 580,
        "y": 620,
        "wires": [
            [
                "057faeb7a45af411"
            ]
        ]
    },
    {
        "id": "36b21015357e24a2",
        "type": "split",
        "z": "71a6f3392a4b5c6a",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 410,
        "y": 620,
        "wires": [
            [
                "70a03caf4fa6bdd9"
            ]
        ]
    },
    {
        "id": "cdb24c573b68359a",
        "type": "http request",
        "z": "e805a8e0f0267c24",
        "name": "JNeuroSci",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://www.jneurosci.org/search/text_abstract_title%3AMultiple%2BSclerosis%20text_abstract_title_flags%3Amatch-phrase%20exclude_meeting_abstracts%3A1%20numresults%3A50%20sort%3Apublication-date%20direction%3Adescending%20format_result%3Astandard",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 290,
        "y": 60,
        "wires": [
            [
                "4d119d6a46a050e0"
            ]
        ]
    },
    {
        "id": "7b728a7025160452",
        "type": "split",
        "z": "e805a8e0f0267c24",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 610,
        "y": 60,
        "wires": [
            [
                "b23819b7d937f2bd"
            ]
        ]
    },
    {
        "id": "b23819b7d937f2bd",
        "type": "change",
        "z": "e805a8e0f0267c24",
        "name": "set source JNeuroSci",
        "rules": [
            {
                "t": "set",
                "p": "article",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article.url",
                "pt": "msg",
                "to": "\"https://www.jneurosci.org\" & payload.link",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.source",
                "pt": "msg",
                "to": "JNeuroSci",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "article.description",
                "pt": "msg",
                "to": "$trim(article.description)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.title",
                "pt": "msg",
                "to": "$trim(article.title)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.pubdate",
                "pt": "msg",
                "to": "$trim($replace(article.pubdate, \"Published: \", \" \"))",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 800,
        "y": 60,
        "wires": [
            [
                "46f424462d3b8d84"
            ]
        ]
    },
    {
        "id": "91864fb3ca44634f",
        "type": "subflow:acf883d8.84eea",
        "z": "e805a8e0f0267c24",
        "name": "Insert SQL",
        "env": [],
        "x": 350,
        "y": 120,
        "wires": [
            [
                "9ba64e2a99e92594"
            ]
        ]
    },
    {
        "id": "990c02a7e3e585c3",
        "type": "inject",
        "z": "e805a8e0f0267c24",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "4",
                "vt": "num"
            }
        ],
        "repeat": "13800",
        "crontab": "",
        "once": true,
        "onceDelay": "85",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 60,
        "wires": [
            [
                "cdb24c573b68359a"
            ]
        ]
    },
    {
        "id": "4d119d6a46a050e0",
        "type": "cheerio",
        "z": "e805a8e0f0267c24",
        "name": "",
        "tag": "li.search-result",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "a",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            },
            {
                "search": "p.NoSummary",
                "ret": "text",
                "replace": "description",
                "attr": ""
            },
            {
                "search": "p.NoDate",
                "ret": "text",
                "replace": "pubdate",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 460,
        "y": 60,
        "wires": [
            [
                "7b728a7025160452"
            ]
        ]
    },
    {
        "id": "46f424462d3b8d84",
        "type": "moment",
        "z": "e805a8e0f0267c24",
        "name": "format pubdate",
        "topic": "",
        "input": "payload.pubdate",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "en-US",
        "output": "article.pubdate",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 160,
        "y": 120,
        "wires": [
            [
                "91864fb3ca44634f"
            ]
        ]
    },
    {
        "id": "677c4a3eb9917e3f",
        "type": "debug",
        "z": "e805a8e0f0267c24",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1700,
        "y": 300,
        "wires": []
    },
    {
        "id": "ef68a3405b31f3c9",
        "type": "comment",
        "z": "e805a8e0f0267c24",
        "name": "ADD JNeuroSci SUMMARY",
        "info": "",
        "x": 180,
        "y": 240,
        "wires": []
    },
    {
        "id": "151f95ef01059a56",
        "type": "split",
        "z": "e805a8e0f0267c24",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 410,
        "y": 300,
        "wires": [
            [
                "a5e4360d50114d90"
            ]
        ]
    },
    {
        "id": "b8937aa025665c47",
        "type": "http request",
        "z": "e805a8e0f0267c24",
        "name": "JNeuroSci",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 630,
        "y": 360,
        "wires": [
            [
                "2e420241b43b41a0"
            ]
        ]
    },
    {
        "id": "8d7c92bc8b7ed0ab",
        "type": "change",
        "z": "e805a8e0f0267c24",
        "name": "set fields",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "payload.link",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article_id",
                "pt": "msg",
                "to": "payload.article_id",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 360,
        "wires": [
            [
                "b8937aa025665c47"
            ]
        ]
    },
    {
        "id": "2e420241b43b41a0",
        "type": "html",
        "z": "e805a8e0f0267c24",
        "name": "",
        "property": "payload",
        "outproperty": "payload",
        "tag": "meta",
        "ret": "attr",
        "as": "multi",
        "x": 270,
        "y": 400,
        "wires": [
            [
                "1e152acca8e12466"
            ]
        ]
    },
    {
        "id": "1e152acca8e12466",
        "type": "switch",
        "z": "e805a8e0f0267c24",
        "name": "",
        "property": "payload.name",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "citation_abstract",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 410,
        "y": 400,
        "wires": [
            [
                "3ac64fb27a70f46d"
            ]
        ]
    },
    {
        "id": "3ac64fb27a70f46d",
        "type": "template",
        "z": "e805a8e0f0267c24",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "UPDATE articles\nset summary = '{{{payload.content}}}'\nwhere article_id = {{article_id}};",
        "output": "str",
        "x": 540,
        "y": 400,
        "wires": [
            [
                "c79fbd3b9003bfcf"
            ]
        ]
    },
    {
        "id": "a5e4360d50114d90",
        "type": "delay",
        "z": "e805a8e0f0267c24",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "30",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 300,
        "y": 360,
        "wires": [
            [
                "8d7c92bc8b7ed0ab"
            ]
        ]
    },
    {
        "id": "4f1a2d803ab4c276",
        "type": "meta",
        "z": "e805a8e0f0267c24",
        "name": "meta",
        "x": 470,
        "y": 620,
        "wires": [
            [
                "d3c8dd25f3b7b403"
            ]
        ]
    },
    {
        "id": "c717a9d1327bb6d5",
        "type": "change",
        "z": "e805a8e0f0267c24",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "article_id",
                "pt": "msg",
                "to": "payload.article_id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.link",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 320,
        "y": 620,
        "wires": [
            [
                "4f1a2d803ab4c276"
            ]
        ]
    },
    {
        "id": "d3c8dd25f3b7b403",
        "type": "moment",
        "z": "e805a8e0f0267c24",
        "name": "",
        "topic": "",
        "input": "payload.citation_publication_date",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "POSIX",
        "output": "datetime",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 160,
        "y": 700,
        "wires": [
            [
                "9b3174810b4a8483"
            ]
        ]
    },
    {
        "id": "9b3174810b4a8483",
        "type": "template",
        "z": "e805a8e0f0267c24",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "update articles set published_date ='{{datetime}}' where article_id  = {{article_id}};",
        "output": "str",
        "x": 340,
        "y": 700,
        "wires": [
            [
                "ec17ee1f5c856e59"
            ]
        ]
    },
    {
        "id": "aee8694a8e049822",
        "type": "comment",
        "z": "e805a8e0f0267c24",
        "name": "populate missing values of published date : working",
        "info": "",
        "x": 250,
        "y": 480,
        "wires": []
    },
    {
        "id": "aeb2687b2b843542",
        "type": "inject",
        "z": "e805a8e0f0267c24",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "4",
                "vt": "str"
            }
        ],
        "repeat": "3600",
        "crontab": "",
        "once": true,
        "onceDelay": "137",
        "topic": "",
        "payload": "select article_id,link from articles where source = 4 and published_date is null limit 10;",
        "payloadType": "str",
        "x": 130,
        "y": 540,
        "wires": [
            [
                "d5a0e22f0f7fff04"
            ]
        ]
    },
    {
        "id": "9ba64e2a99e92594",
        "type": "postgres",
        "z": "e805a8e0f0267c24",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 540,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "f6ed33070288adaf",
        "type": "inject",
        "z": "e805a8e0f0267c24",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "7200",
        "crontab": "",
        "once": true,
        "onceDelay": "123",
        "topic": "",
        "payload": "SELECT \tarticle_id, \tlink FROM \tarticles WHERE \tsource = 4 \tAND published_date IS NULL ORDER BY \tarticle_id DESC LIMIT 10;",
        "payloadType": "str",
        "x": 130,
        "y": 300,
        "wires": [
            [
                "8ffc7c2923c3483f"
            ]
        ]
    },
    {
        "id": "8ffc7c2923c3483f",
        "type": "postgres",
        "z": "e805a8e0f0267c24",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 280,
        "y": 300,
        "wires": [
            [
                "151f95ef01059a56"
            ]
        ]
    },
    {
        "id": "c79fbd3b9003bfcf",
        "type": "postgres",
        "z": "e805a8e0f0267c24",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 720,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "d5a0e22f0f7fff04",
        "type": "postgres",
        "z": "e805a8e0f0267c24",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 270,
        "y": 540,
        "wires": [
            [
                "05bc980102e4c098"
            ]
        ]
    },
    {
        "id": "ec17ee1f5c856e59",
        "type": "postgres",
        "z": "e805a8e0f0267c24",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 520,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "05bc980102e4c098",
        "type": "split",
        "z": "e805a8e0f0267c24",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 410,
        "y": 540,
        "wires": [
            [
                "7d451d4652f97f1c"
            ]
        ]
    },
    {
        "id": "7d451d4652f97f1c",
        "type": "delay",
        "z": "e805a8e0f0267c24",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "10",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 140,
        "y": 620,
        "wires": [
            [
                "c717a9d1327bb6d5"
            ]
        ]
    },
    {
        "id": "22dd066d64cb444c",
        "type": "inject",
        "z": "390b6f59c14b2f84",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "5",
                "vt": "num"
            }
        ],
        "repeat": "13800",
        "crontab": "",
        "once": true,
        "onceDelay": "200",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 166.66665649414062,
        "y": 101.66666412353516,
        "wires": [
            [
                "154bee168716a2ed"
            ]
        ]
    },
    {
        "id": "154bee168716a2ed",
        "type": "http request",
        "z": "390b6f59c14b2f84",
        "name": "MS and Rel. Disorders",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://www.msard-journal.com/action/doSearch?text1=Multiple+Sclerosis&field1=AbstractTitleKeywordFilterField&startPage=0&sortBy=Earliest",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 386.6666564941406,
        "y": 101.66666412353516,
        "wires": [
            [
                "f6f273178b883b74"
            ]
        ]
    },
    {
        "id": "4f6a33ec203b859c",
        "type": "split",
        "z": "390b6f59c14b2f84",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 750,
        "y": 100,
        "wires": [
            [
                "111ba9bef37fea83"
            ]
        ]
    },
    {
        "id": "111ba9bef37fea83",
        "type": "change",
        "z": "390b6f59c14b2f84",
        "name": "set source MS & rel. disorders",
        "rules": [
            {
                "t": "set",
                "p": "article",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article.url",
                "pt": "msg",
                "to": "\"https://www.msard-journal.com\" & payload.link",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.source",
                "pt": "msg",
                "to": "MS & Rel. Disorders",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "article.description",
                "pt": "msg",
                "to": "not available",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "article.title",
                "pt": "msg",
                "to": "$trim(article.title)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.pubdate",
                "pt": "msg",
                "to": "$split($trim($replace(article.pubdate, \"Published Online: \", \" \")),\".\",1)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 950,
        "y": 100,
        "wires": [
            [
                "eda16176c3e2508f"
            ]
        ]
    },
    {
        "id": "eda16176c3e2508f",
        "type": "change",
        "z": "390b6f59c14b2f84",
        "name": "fix pubdate",
        "rules": [
            {
                "t": "set",
                "p": "payload.pubdate",
                "pt": "msg",
                "to": "$replace($replace(payload.pubdate[0],\" \", \"-\"),\",\",\"\")",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 160,
        "wires": [
            [
                "97c7dc7bf638bbb6"
            ]
        ]
    },
    {
        "id": "bbc16bbfd93e4cb6",
        "type": "subflow:acf883d8.84eea",
        "z": "390b6f59c14b2f84",
        "name": "Insert SQL",
        "env": [],
        "x": 850,
        "y": 160,
        "wires": [
            [
                "80f7e3a0e7e3879e"
            ]
        ]
    },
    {
        "id": "f6f273178b883b74",
        "type": "cheerio",
        "z": "390b6f59c14b2f84",
        "name": "",
        "tag": "li.search__item",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "h4.meta__title",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "h4.meta__title>a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            },
            {
                "search": "div.hlFld-Abstract.preview-abstract",
                "ret": "text",
                "replace": "description",
                "attr": ""
            },
            {
                "search": "p.meta__details > span:nth-child(3)",
                "ret": "text",
                "replace": "pubdate",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 600,
        "y": 100,
        "wires": [
            [
                "4f6a33ec203b859c"
            ]
        ]
    },
    {
        "id": "97c7dc7bf638bbb6",
        "type": "moment",
        "z": "390b6f59c14b2f84",
        "name": "format pubdate",
        "topic": "",
        "input": "payload.pubdate",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "en-US",
        "output": "article.pubdate",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 660,
        "y": 160,
        "wires": [
            [
                "bbc16bbfd93e4cb6"
            ]
        ]
    },
    {
        "id": "622d1f7325563ed3",
        "type": "comment",
        "z": "390b6f59c14b2f84",
        "name": "ADD MS & Rel. Disorders SUMMARY",
        "info": "",
        "x": 210,
        "y": 240,
        "wires": []
    },
    {
        "id": "ce0e9cbad8c16ed2",
        "type": "split",
        "z": "390b6f59c14b2f84",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 390,
        "y": 300,
        "wires": [
            [
                "f6a856b17eae0b66"
            ]
        ]
    },
    {
        "id": "946d29f66c892ce3",
        "type": "http request",
        "z": "390b6f59c14b2f84",
        "name": "MS & Rel. Disorders",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 640,
        "y": 360,
        "wires": [
            [
                "a0af8a9aa59e97f2"
            ]
        ]
    },
    {
        "id": "a0af8a9aa59e97f2",
        "type": "html",
        "z": "390b6f59c14b2f84",
        "name": "",
        "property": "payload",
        "outproperty": "payload",
        "tag": "meta",
        "ret": "attr",
        "as": "multi",
        "x": 810,
        "y": 360,
        "wires": [
            [
                "489e2d821c2cd54c"
            ]
        ]
    },
    {
        "id": "de3cb85a5789640f",
        "type": "change",
        "z": "390b6f59c14b2f84",
        "name": "set fields",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "payload.link",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article_id",
                "pt": "msg",
                "to": "payload.article_id",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 360,
        "wires": [
            [
                "946d29f66c892ce3"
            ]
        ]
    },
    {
        "id": "489e2d821c2cd54c",
        "type": "switch",
        "z": "390b6f59c14b2f84",
        "name": "",
        "property": "payload.name",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "citation_abstract",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 950,
        "y": 360,
        "wires": [
            [
                "1d8285319979402a"
            ]
        ]
    },
    {
        "id": "43563063d7f604fb",
        "type": "template",
        "z": "390b6f59c14b2f84",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "UPDATE articles\nset summary = '{{{payload.content}}}'\nwhere article_id = {{article_id}};",
        "output": "str",
        "x": 600,
        "y": 420,
        "wires": [
            [
                "857c6c7ebbadc2a1"
            ]
        ]
    },
    {
        "id": "2ad42bc3de66f08f",
        "type": "inject",
        "z": "390b6f59c14b2f84",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "5",
                "vt": "str"
            }
        ],
        "repeat": "7200",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "SELECT * FROM articles  WHERE source = 5 AND summary ='not available' OR summary IS NULL ;",
        "payloadType": "str",
        "x": 120,
        "y": 300,
        "wires": [
            [
                "7952d680935e03aa"
            ]
        ]
    },
    {
        "id": "f6a856b17eae0b66",
        "type": "delay",
        "z": "390b6f59c14b2f84",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "5",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 300,
        "y": 360,
        "wires": [
            [
                "de3cb85a5789640f"
            ]
        ]
    },
    {
        "id": "1dab9052f7cd3a6e",
        "type": "change",
        "z": "390b6f59c14b2f84",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "article_id",
                "pt": "msg",
                "to": "payload[0].article_id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "payload[0].link",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 660,
        "wires": [
            [
                "33f276fda5291248"
            ]
        ]
    },
    {
        "id": "a67d8f8f4c30a2a8",
        "type": "comment",
        "z": "390b6f59c14b2f84",
        "name": "populate missing values of published date not working",
        "info": "",
        "x": 260,
        "y": 540,
        "wires": []
    },
    {
        "id": "47ddc0f08e33d626",
        "type": "cheerio",
        "z": "390b6f59c14b2f84",
        "name": "",
        "tag": "span.article-header__publish-date__value",
        "ret": "html",
        "as": "single",
        "map": [
            {
                "search": "",
                "ret": "text",
                "replace": "published_date",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": false,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 380,
        "y": 720,
        "wires": [
            [
                "009a7721ec65f8d9"
            ]
        ]
    },
    {
        "id": "009a7721ec65f8d9",
        "type": "moment",
        "z": "390b6f59c14b2f84",
        "name": "",
        "topic": "",
        "input": "payload[0]",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "POSIX",
        "output": "",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 200,
        "y": 780,
        "wires": [
            [
                "594412324686b248"
            ]
        ]
    },
    {
        "id": "594412324686b248",
        "type": "template",
        "z": "390b6f59c14b2f84",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "update articles set published_date ='{{payload}}' where article_id  = {{article_id}};",
        "output": "str",
        "x": 400,
        "y": 780,
        "wires": [
            [
                "12b09aa9b5abbf08"
            ]
        ]
    },
    {
        "id": "12b09aa9b5abbf08",
        "type": "debug",
        "z": "390b6f59c14b2f84",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 210,
        "y": 840,
        "wires": []
    },
    {
        "id": "33f276fda5291248",
        "type": "http request",
        "z": "390b6f59c14b2f84",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "",
        "persist": false,
        "authType": "",
        "senderr": false,
        "x": 130,
        "y": 720,
        "wires": [
            [
                "47ddc0f08e33d626"
            ]
        ]
    },
    {
        "id": "80f7e3a0e7e3879e",
        "type": "postgres",
        "z": "390b6f59c14b2f84",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 1020,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "7952d680935e03aa",
        "type": "postgres",
        "z": "390b6f59c14b2f84",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 260,
        "y": 300,
        "wires": [
            [
                "ce0e9cbad8c16ed2"
            ]
        ]
    },
    {
        "id": "857c6c7ebbadc2a1",
        "type": "postgres",
        "z": "390b6f59c14b2f84",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 740,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "e46bbe82c79e2097",
        "type": "inject",
        "z": "390b6f59c14b2f84",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "5",
                "vt": "str"
            }
        ],
        "repeat": "7200",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "select article_id,link from articles where source = \"MS & Rel. Disorders\" and published_date is null order by article_id desc limit 1;",
        "payloadType": "str",
        "x": 130,
        "y": 600,
        "wires": [
            [
                "492a68e44e506b0f"
            ]
        ]
    },
    {
        "id": "492a68e44e506b0f",
        "type": "postgres",
        "z": "390b6f59c14b2f84",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 260,
        "y": 600,
        "wires": [
            [
                "7a830546d21c3887"
            ]
        ]
    },
    {
        "id": "7a830546d21c3887",
        "type": "split",
        "z": "390b6f59c14b2f84",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 410,
        "y": 600,
        "wires": [
            [
                "209239ad9b7f9a27"
            ]
        ]
    },
    {
        "id": "209239ad9b7f9a27",
        "type": "delay",
        "z": "390b6f59c14b2f84",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "5",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 140,
        "y": 660,
        "wires": [
            [
                "1dab9052f7cd3a6e"
            ]
        ]
    },
    {
        "id": "1d8285319979402a",
        "type": "change",
        "z": "390b6f59c14b2f84",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.content",
                "pt": "msg",
                "to": "$replace(payload.content, \"'\", \"''\")\t",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 370,
        "y": 420,
        "wires": [
            [
                "43563063d7f604fb"
            ]
        ]
    },
    {
        "id": "1562388da3252879",
        "type": "feedparse",
        "z": "6143695246b35bf7",
        "d": true,
        "name": "FASEB",
        "url": "https://faseb.onlinelibrary.wiley.com/action/showFeed?ui=0&mi=2h5krp8&type=search&feed=rss&query=%2526content%253DarticlesChapters%2526field1%253DAllField%2526publication%253D15306860%2526target%253Ddefault%2526text1%253DMultiple%252BSclerosis%252BOR%252Bautoimmune%252Bencephalomyelitis%252BOR%252Bencephalomyelitis%252BOR%252Bimmune%252Btolerance%252BOR%252Bmyelin",
        "interval": "67",
        "x": 110,
        "y": 40,
        "wires": [
            [
                "5e86548a84579bb6"
            ]
        ]
    },
    {
        "id": "5e86548a84579bb6",
        "type": "change",
        "z": "6143695246b35bf7",
        "name": "set source FASEB",
        "rules": [
            {
                "t": "set",
                "p": "source",
                "pt": "msg",
                "to": "3",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "article.url",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 270,
        "y": 40,
        "wires": [
            [
                "9b0e28eb73495b42"
            ]
        ]
    },
    {
        "id": "9b0e28eb73495b42",
        "type": "moment",
        "z": "6143695246b35bf7",
        "name": "format pubdate",
        "topic": "",
        "input": "article.pubdate",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "en-US",
        "output": "article.pubdate",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 460,
        "y": 40,
        "wires": [
            [
                "6aadb6bff130ded9"
            ]
        ]
    },
    {
        "id": "6aadb6bff130ded9",
        "type": "subflow:acf883d8.84eea",
        "z": "6143695246b35bf7",
        "name": "",
        "env": [],
        "x": 680,
        "y": 40,
        "wires": [
            [
                "eb8fdf1b8e450484"
            ]
        ]
    },
    {
        "id": "eb8fdf1b8e450484",
        "type": "postgres",
        "z": "6143695246b35bf7",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 860,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "6db266126079177f",
        "type": "change",
        "z": "0e63a1d341727118",
        "name": "set source ClinicalTrials",
        "rules": [
            {
                "t": "set",
                "p": "article.source",
                "pt": "msg",
                "to": "ClinicalTrials.gov",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 320,
        "wires": [
            [
                "b25c685915f792da"
            ]
        ]
    },
    {
        "id": "987b19e9461e07c6",
        "type": "template",
        "z": "0e63a1d341727118",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "INSERT INTO trials (discovery_date,title,summary,link,published_date,source,relevant)\nVALUES (current_timestamp,'{{article.title}}','{{article.description}}','{{{topic}}}','{{article.pubdate}}','{{article.source}}',NULL)",
        "output": "str",
        "x": 880,
        "y": 320,
        "wires": [
            [
                "0258a1d16043cde1"
            ]
        ]
    },
    {
        "id": "1220577add3d2029",
        "type": "http request",
        "z": "0e63a1d341727118",
        "name": "NOVARTIS",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://www.novartis.com/clinicaltrials/recruiting-trials?title=multiple%20sclerosis",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 370,
        "y": 160,
        "wires": [
            [
                "dd1197513d93c54a"
            ]
        ]
    },
    {
        "id": "1b749bbdc058e238",
        "type": "inject",
        "z": "0e63a1d341727118",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "18000",
        "crontab": "",
        "once": true,
        "onceDelay": "200",
        "topic": "",
        "payloadType": "date",
        "x": 190,
        "y": 160,
        "wires": [
            [
                "1220577add3d2029"
            ]
        ]
    },
    {
        "id": "101955da717a8d85",
        "type": "template",
        "z": "0e63a1d341727118",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "INSERT INTO trials (discovery_date, title, summary, link, published_date, source, relevant)\n\t\tVALUES(CURRENT_TIMESTAMP, '{{payload.title}}', NULL, 'https://www.novartis.com/{{{payload.link}}}', NULL, 'Novartis', NULL)",
        "output": "str",
        "x": 880,
        "y": 160,
        "wires": [
            [
                "0258a1d16043cde1"
            ]
        ]
    },
    {
        "id": "5100d9cbe6debfb8",
        "type": "split",
        "z": "0e63a1d341727118",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 730,
        "y": 160,
        "wires": [
            [
                "101955da717a8d85"
            ]
        ]
    },
    {
        "id": "b988a74fcce07d85",
        "type": "http request",
        "z": "0e63a1d341727118",
        "name": "CUF",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://www.cuf.pt/cuf-academic-center/ensaios-clinicos?combine=&unidade=&estado=All&patologia=2346&especialidade=",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 350,
        "y": 240,
        "wires": [
            [
                "781b96b4e08febbc"
            ]
        ]
    },
    {
        "id": "22f6ee790f6946ee",
        "type": "inject",
        "z": "0e63a1d341727118",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "18000",
        "crontab": "",
        "once": true,
        "onceDelay": "42",
        "topic": "",
        "payloadType": "date",
        "x": 190,
        "y": 240,
        "wires": [
            [
                "b988a74fcce07d85"
            ]
        ]
    },
    {
        "id": "3216d3df82cdd2cb",
        "type": "template",
        "z": "0e63a1d341727118",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "INSERT INTO trials (discovery_date,title,summary,link,published_date,source,relevant)\nVALUES (current_timestamp,'{{payload.title}}',NULL,'https://www.cuf.pt{{{payload.link}}}',NULL,'CUF',NULL)",
        "output": "str",
        "x": 880,
        "y": 240,
        "wires": [
            [
                "0258a1d16043cde1"
            ]
        ]
    },
    {
        "id": "2388ed9e006b5d83",
        "type": "split",
        "z": "0e63a1d341727118",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 730,
        "y": 240,
        "wires": [
            [
                "3216d3df82cdd2cb"
            ]
        ]
    },
    {
        "id": "6f51b02e4e5fa4b9",
        "type": "comment",
        "z": "0e63a1d341727118",
        "name": "Clinical Trials",
        "info": "",
        "x": 130,
        "y": 120,
        "wires": []
    },
    {
        "id": "ef01cfeb133702c5",
        "type": "feedparse",
        "z": "0e63a1d341727118",
        "name": "Clinical Trials.gov",
        "url": "https://clinicaltrials.gov/ct2/results/rss.xml?rcv_d=14&lup_d=&sel_rss=new14&cond=Multiple+Sclerosis&count=10000",
        "interval": "3",
        "x": 160,
        "y": 320,
        "wires": [
            [
                "6db266126079177f"
            ]
        ]
    },
    {
        "id": "dd1197513d93c54a",
        "type": "cheerio",
        "z": "0e63a1d341727118",
        "name": "Novartis",
        "tag": "td.views-field",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "a",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "td.views-field.views-field-title>a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 580,
        "y": 160,
        "wires": [
            [
                "5100d9cbe6debfb8"
            ]
        ]
    },
    {
        "id": "781b96b4e08febbc",
        "type": "cheerio",
        "z": "0e63a1d341727118",
        "name": "cuf",
        "tag": "div.content",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": ".field--name-title-text",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 570,
        "y": 240,
        "wires": [
            [
                "2388ed9e006b5d83"
            ]
        ]
    },
    {
        "id": "b25c685915f792da",
        "type": "moment",
        "z": "0e63a1d341727118",
        "name": "format pubdate",
        "topic": "",
        "input": "article.date",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "en-US",
        "output": "article.pubdate",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 620,
        "y": 320,
        "wires": [
            [
                "987b19e9461e07c6"
            ]
        ]
    },
    {
        "id": "1214adfc81ae6c5b",
        "type": "change",
        "z": "0e63a1d341727118",
        "name": "set source ClinicalTrialsEU",
        "rules": [
            {
                "t": "set",
                "p": "article.source",
                "pt": "msg",
                "to": "clinicaltrialsregister.eu",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 420,
        "wires": [
            [
                "125e35d3528ec5b0"
            ]
        ]
    },
    {
        "id": "9655fd650e8c20eb",
        "type": "template",
        "z": "0e63a1d341727118",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "INSERT INTO trials (discovery_date,title,summary,link,published_date,source,relevant)\nVALUES (current_timestamp,'{{article.title}}','{{article.description}}','{{{topic}}}','{{article.pubdate}}','{{article.source}}',NULL)",
        "output": "str",
        "x": 880,
        "y": 420,
        "wires": [
            [
                "0258a1d16043cde1"
            ]
        ]
    },
    {
        "id": "5be7b056bb4e0551",
        "type": "feedparse",
        "z": "0e63a1d341727118",
        "d": true,
        "name": "clinicaltrialsregister.eu",
        "url": "http://www.clinicaltrialsregister.eu/ctr-search/rest/feed/bydates?query=multiple+sclerosis",
        "interval": "999",
        "x": 180,
        "y": 420,
        "wires": [
            [
                "1214adfc81ae6c5b"
            ]
        ]
    },
    {
        "id": "125e35d3528ec5b0",
        "type": "moment",
        "z": "0e63a1d341727118",
        "name": "format pubdate",
        "topic": "",
        "input": "article.date",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "en-US",
        "output": "payload",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 640,
        "y": 420,
        "wires": [
            [
                "9655fd650e8c20eb"
            ]
        ]
    },
    {
        "id": "0258a1d16043cde1",
        "type": "postgres",
        "z": "0e63a1d341727118",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": false,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": false,
        "x": 1140,
        "y": 260,
        "wires": []
    },
    {
        "id": "08843a43c7cc19c1",
        "type": "change",
        "z": "ed1d968f509a241a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "SELECT  * FROM articles ORDER BY article_id DESC;",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 240,
        "wires": [
            [
                "8089e901f648e1ac"
            ]
        ]
    },
    {
        "id": "2de42969e58fa460",
        "type": "change",
        "z": "ed1d968f509a241a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "SELECT  * FROM trials ORDER BY trial_id DESC;",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 600,
        "wires": [
            [
                "8089e901f648e1ac"
            ]
        ]
    },
    {
        "id": "7fbf634499ab044f",
        "type": "http in",
        "z": "ed1d968f509a241a",
        "name": "",
        "url": "/trials/id/:id",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 200,
        "y": 520,
        "wires": [
            [
                "8954a956a44acfb2"
            ]
        ]
    },
    {
        "id": "6be09f5fabf8312a",
        "type": "http in",
        "z": "ed1d968f509a241a",
        "name": "",
        "url": "/articles/all",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 220,
        "y": 240,
        "wires": [
            [
                "6bcbd03003145a20"
            ]
        ]
    },
    {
        "id": "42f75fa0ccc65af7",
        "type": "http in",
        "z": "ed1d968f509a241a",
        "name": "",
        "url": "/articles/source/:source",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 320,
        "wires": [
            [
                "5afac07baef3483b"
            ]
        ]
    },
    {
        "id": "946636f71217b73d",
        "type": "http in",
        "z": "ed1d968f509a241a",
        "name": "",
        "url": "/trials/all",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 230,
        "y": 600,
        "wires": [
            [
                "a40c7340e5fbfef8"
            ]
        ]
    },
    {
        "id": "bf720f2e31bd565f",
        "type": "change",
        "z": "ed1d968f509a241a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "SELECT  * FROM articles where relevant = true ORDER BY article_id DESC;",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 280,
        "wires": [
            [
                "8089e901f648e1ac"
            ]
        ]
    },
    {
        "id": "936cb6b5e6eea95d",
        "type": "http in",
        "z": "ed1d968f509a241a",
        "name": "",
        "url": "/articles/relevant",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 200,
        "y": 280,
        "wires": [
            [
                "76665e8c2a91cfae"
            ]
        ]
    },
    {
        "id": "6832ddc546050fc2",
        "type": "json",
        "z": "ed1d968f509a241a",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1370,
        "y": 320,
        "wires": [
            [
                "414e046cf10dd148"
            ]
        ]
    },
    {
        "id": "414e046cf10dd148",
        "type": "change",
        "z": "ed1d968f509a241a",
        "name": "Set Headers",
        "rules": [
            {
                "t": "set",
                "p": "headers",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "headers.content-type",
                "pt": "msg",
                "to": "application/json",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1510,
        "y": 320,
        "wires": [
            [
                "40c239ea0f040c78"
            ]
        ]
    },
    {
        "id": "40c239ea0f040c78",
        "type": "http response",
        "z": "ed1d968f509a241a",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1650,
        "y": 320,
        "wires": []
    },
    {
        "id": "e5f8d1f919b35783",
        "type": "http in",
        "z": "ed1d968f509a241a",
        "name": "",
        "url": "/articles/id/:id/relevant/1",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 1020,
        "wires": [
            [
                "9880d8bf6a202db7",
                "ef627abb865f90b4"
            ]
        ]
    },
    {
        "id": "7b8891c62f947d03",
        "type": "http in",
        "z": "ed1d968f509a241a",
        "name": "",
        "url": "/articles/id/:id/relevant/0",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 940,
        "wires": [
            [
                "672dae26ade75533"
            ]
        ]
    },
    {
        "id": "8bd6d1352c1b7e05",
        "type": "change",
        "z": "ed1d968f509a241a",
        "name": "status = OK ",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"status\":\"OK\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 930,
        "y": 980,
        "wires": [
            [
                "13fccd5c282d8b58"
            ]
        ]
    },
    {
        "id": "13fccd5c282d8b58",
        "type": "change",
        "z": "ed1d968f509a241a",
        "name": "Set Headers",
        "rules": [
            {
                "t": "set",
                "p": "headers",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "headers.content-type",
                "pt": "msg",
                "to": "application/json",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1090,
        "y": 980,
        "wires": [
            [
                "ad66261d5b85bbe6"
            ]
        ]
    },
    {
        "id": "ad66261d5b85bbe6",
        "type": "http response",
        "z": "ed1d968f509a241a",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1230,
        "y": 980,
        "wires": []
    },
    {
        "id": "7bfdfbb64dd7603e",
        "type": "function",
        "z": "ed1d968f509a241a",
        "name": "Prepare Notion DB payload",
        "func": "var data = msg.payload[0]\nvar title = msg.payload[0].title\nvar url = msg.payload[0].link\n\n\n\nvar postData = {\n\t\"parent\": { \"database_id\": \"4fa1dc37-a3bf-43be-9c8d-35b41e539f8d\" },\n\t\"properties\": {\n\t\t\"Name\": {\n\t\t\t\"title\": [\n\t\t\t\t{\n\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\"content\": title\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t},\n\t\t\"Status\": {\n\t\t    \"select\": {\n\t\t        \"name\": \"Auto\"\n\t\t    }\n\t\t},\n        \"Link\": {\n            \"url\": url\n        }\n\t\t\n}}\n\n\n\n//\t\t\"Context\": {\n//\t\t\t\"select\": {\n//\t\t\t\t\"name\": context\n//\t\t\t}\n//\t\t},\n//\t\t\"Client\": {\n//\t\t    \"select\": {\n//\t\t        \"name\": client\n//\t\t    }\n//\t\t}\n\nmsg.payload = postData\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 1060,
        "wires": [
            [
                "5be0f0c5d5c291e4"
            ]
        ]
    },
    {
        "id": "5be0f0c5d5c291e4",
        "type": "http request",
        "z": "ed1d968f509a241a",
        "name": "create page",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.notion.com/v1/pages",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "bearer",
        "x": 1330,
        "y": 1060,
        "wires": [
            [
                "1e1ffb8d77abbde8"
            ]
        ]
    },
    {
        "id": "c0a8bcb8b5eed125",
        "type": "delay",
        "z": "ed1d968f509a241a",
        "name": "",
        "pauseType": "random",
        "timeout": "5",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "10",
        "rateUnits": "minute",
        "randomFirst": "6",
        "randomLast": "15",
        "randomUnits": "minutes",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 920,
        "y": 1060,
        "wires": [
            [
                "7bfdfbb64dd7603e"
            ]
        ]
    },
    {
        "id": "0cadef73befc76a1",
        "type": "http in",
        "z": "ed1d968f509a241a",
        "name": "",
        "url": "/articles/sources",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 200,
        "y": 440,
        "wires": [
            [
                "a5a1bd7a98d4a993"
            ]
        ]
    },
    {
        "id": "dc5687c51e9fecfa",
        "type": "change",
        "z": "ed1d968f509a241a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "select source_id,name,link   from sources  order by name ASC;",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 440,
        "wires": [
            [
                "8089e901f648e1ac"
            ]
        ]
    },
    {
        "id": "1de40aebce227407",
        "type": "http in",
        "z": "ed1d968f509a241a",
        "name": "",
        "url": "/trials/sources",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 210,
        "y": 560,
        "wires": [
            [
                "33711c0523948df7"
            ]
        ]
    },
    {
        "id": "3d88dfe4df13ea2d",
        "type": "change",
        "z": "ed1d968f509a241a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "select distinct source   from trials  order by source ASC;",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 560,
        "wires": [
            [
                "8089e901f648e1ac"
            ]
        ]
    },
    {
        "id": "49a9ae960e3ce4cc",
        "type": "http in",
        "z": "ed1d968f509a241a",
        "name": "",
        "url": "/articles/keyword/:keyword",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 170,
        "y": 1180,
        "wires": [
            [
                "e75c16ed3a2a8728"
            ]
        ]
    },
    {
        "id": "bb4cea85d54728e7",
        "type": "sqlstring-format",
        "z": "ed1d968f509a241a",
        "name": "",
        "query": "SELECT\n\t*\nFROM\n\tarticles\nWHERE\n\ttitle LIKE (?);",
        "vars": "keyword",
        "outField": "payload",
        "x": 810,
        "y": 1180,
        "wires": [
            [
                "706b5df9f6b21a41"
            ]
        ]
    },
    {
        "id": "af3f3488f9807b0a",
        "type": "change",
        "z": "ed1d968f509a241a",
        "name": "set keyword",
        "rules": [
            {
                "t": "set",
                "p": "keyword",
                "pt": "msg",
                "to": "\"%\" & req.params.keyword & \"%\"",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 1180,
        "wires": [
            [
                "bb4cea85d54728e7"
            ]
        ]
    },
    {
        "id": "2c1e21cb9af57251",
        "type": "http in",
        "z": "ed1d968f509a241a",
        "name": "",
        "url": "/trials/keyword/:keyword",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 1240,
        "wires": [
            [
                "1ba768c6f5c4ce02"
            ]
        ]
    },
    {
        "id": "4475037a98e468ec",
        "type": "change",
        "z": "ed1d968f509a241a",
        "name": "set keyword",
        "rules": [
            {
                "t": "set",
                "p": "keyword",
                "pt": "msg",
                "to": "\"%\" & req.params.keyword & \"%\"",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 1240,
        "wires": [
            [
                "03c4b05740cccd41"
            ]
        ]
    },
    {
        "id": "03c4b05740cccd41",
        "type": "sqlstring-format",
        "z": "ed1d968f509a241a",
        "name": "",
        "query": "SELECT\n\t*\nFROM\n\ttrials\nWHERE\n\ttitle LIKE (?);",
        "vars": "keyword",
        "outField": "payload",
        "x": 810,
        "y": 1240,
        "wires": [
            [
                "706b5df9f6b21a41"
            ]
        ]
    },
    {
        "id": "c006f78cb6d3e0e6",
        "type": "http in",
        "z": "ed1d968f509a241a",
        "name": "",
        "url": "/articles/related/",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 1300,
        "wires": [
            [
                "999e2deb414d9ce8"
            ]
        ]
    },
    {
        "id": "b066e85a9e026e20",
        "type": "sqlstring-format",
        "z": "ed1d968f509a241a",
        "name": "",
        "query": "SELECT  * FROM trials where trial_id = ? ORDER BY trial_id DESC;",
        "vars": "req.params.id",
        "outField": "payload",
        "x": 690,
        "y": 520,
        "wires": [
            [
                "8089e901f648e1ac"
            ]
        ]
    },
    {
        "id": "86c6a848cc148a02",
        "type": "sqlstring-format",
        "z": "ed1d968f509a241a",
        "name": "",
        "query": "SELECT  * FROM articles where source = ? ORDER BY article_id DESC;",
        "vars": "req.params.source",
        "outField": "payload",
        "x": 690,
        "y": 320,
        "wires": [
            [
                "8089e901f648e1ac"
            ]
        ]
    },
    {
        "id": "878646332f28d3d3",
        "type": "sqlstring-format",
        "z": "ed1d968f509a241a",
        "name": "",
        "query": "UPDATE articles\nSET relevant = false\nWHERE article_id = ?;",
        "vars": "req.params.id",
        "outField": "payload",
        "x": 550,
        "y": 940,
        "wires": [
            [
                "3749b6e93d13ae27"
            ]
        ]
    },
    {
        "id": "cb73fef320f86a0a",
        "type": "sqlstring-format",
        "z": "ed1d968f509a241a",
        "name": "",
        "query": "UPDATE articles\nSET relevant = true\nWHERE article_id = ?;",
        "vars": "req.params.id",
        "outField": "payload",
        "x": 550,
        "y": 1000,
        "wires": [
            [
                "3749b6e93d13ae27"
            ]
        ]
    },
    {
        "id": "41120e6782e2a5f8",
        "type": "sqlstring-format",
        "z": "ed1d968f509a241a",
        "name": "",
        "query": "SELECT  * FROM articles where article_id = ? ORDER BY article_id DESC;",
        "vars": "req.params.id",
        "outField": "payload",
        "x": 550,
        "y": 1060,
        "wires": [
            [
                "3749b6e93d13ae27"
            ]
        ]
    },
    {
        "id": "2058751c1d9b0918",
        "type": "template",
        "z": "ed1d968f509a241a",
        "name": "Query",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "select * from articles\nwhere\n(title = '')\n{{#keywords}}\nOR (title like '%{{.}}%')\n{{/keywords}}\n;",
        "output": "str",
        "x": 810,
        "y": 1300,
        "wires": [
            [
                "706b5df9f6b21a41"
            ]
        ]
    },
    {
        "id": "cdbd05862cd8c88e",
        "type": "function",
        "z": "ed1d968f509a241a",
        "name": "",
        "func": "let words = msg.payload.keywords\nlet keywords = [];\n\nfor (const element of words) {\n  keywords.push(element.match(/(?:\\w|\\s|-\\w)*/)[0])\n}\n\nmsg.keywords = keywords;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 660,
        "y": 1300,
        "wires": [
            [
                "2058751c1d9b0918"
            ]
        ]
    },
    {
        "id": "43cb553ff2e1be99",
        "type": "http response",
        "z": "ed1d968f509a241a",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1490,
        "y": 1220,
        "wires": []
    },
    {
        "id": "0e03fd9c340c3244",
        "type": "json",
        "z": "ed1d968f509a241a",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1190,
        "y": 1220,
        "wires": [
            [
                "878ba106d22fcf7a"
            ]
        ]
    },
    {
        "id": "878ba106d22fcf7a",
        "type": "change",
        "z": "ed1d968f509a241a",
        "name": "Set Headers",
        "rules": [
            {
                "t": "set",
                "p": "headers",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "headers.content-type",
                "pt": "msg",
                "to": "application/json",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1330,
        "y": 1220,
        "wires": [
            [
                "43cb553ff2e1be99"
            ]
        ]
    },
    {
        "id": "eb769a3d5e707ded",
        "type": "http in",
        "z": "ed1d968f509a241a",
        "name": "",
        "url": "/articles/unsent",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 210,
        "y": 100,
        "wires": [
            [
                "9b9e5f001768e6b3"
            ]
        ]
    },
    {
        "id": "681914b9361e091e",
        "type": "change",
        "z": "ed1d968f509a241a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "SELECT  * FROM articles where sent_to_subscribers = false or sent_to_subscribers is NULL  ORDER BY article_id DESC;",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 630,
        "y": 100,
        "wires": [
            [
                "8089e901f648e1ac"
            ]
        ]
    },
    {
        "id": "b0ae9a1504505e09",
        "type": "http in",
        "z": "ed1d968f509a241a",
        "name": "",
        "url": "/",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 170,
        "y": 60,
        "wires": [
            [
                "4fad85aaea6780f5"
            ]
        ]
    },
    {
        "id": "a4333998a0213cbc",
        "type": "http response",
        "z": "ed1d968f509a241a",
        "name": "",
        "statusCode": "302",
        "headers": {
            "location": "https://gregory-ms.com"
        },
        "x": 600,
        "y": 60,
        "wires": []
    },
    {
        "id": "4fad85aaea6780f5",
        "type": "template",
        "z": "ed1d968f509a241a",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<h1>Please visit <a href=\"https://gregory-ms.com\">https://gregory-ms.com</a></h1>",
        "output": "str",
        "x": 360,
        "y": 60,
        "wires": [
            [
                "a4333998a0213cbc"
            ]
        ]
    },
    {
        "id": "4a161b1010e3b2de",
        "type": "debug",
        "z": "ed1d968f509a241a",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1510,
        "y": 1100,
        "wires": []
    },
    {
        "id": "1e1ffb8d77abbde8",
        "type": "json",
        "z": "ed1d968f509a241a",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1470,
        "y": 1060,
        "wires": [
            [
                "4a161b1010e3b2de"
            ]
        ]
    },
    {
        "id": "9b9e5f001768e6b3",
        "type": "subflow:d353eec5835441c0",
        "z": "ed1d968f509a241a",
        "name": "throttle requests",
        "env": [],
        "x": 420,
        "y": 100,
        "wires": [
            [
                "681914b9361e091e"
            ]
        ]
    },
    {
        "id": "8954a956a44acfb2",
        "type": "subflow:d353eec5835441c0",
        "z": "ed1d968f509a241a",
        "name": "throttle requests",
        "env": [],
        "x": 400,
        "y": 520,
        "wires": [
            [
                "b066e85a9e026e20"
            ]
        ]
    },
    {
        "id": "6bcbd03003145a20",
        "type": "subflow:d353eec5835441c0",
        "z": "ed1d968f509a241a",
        "name": "throttle requests",
        "env": [],
        "x": 400,
        "y": 240,
        "wires": [
            [
                "08843a43c7cc19c1"
            ]
        ]
    },
    {
        "id": "76665e8c2a91cfae",
        "type": "subflow:d353eec5835441c0",
        "z": "ed1d968f509a241a",
        "name": "throttle requests",
        "env": [],
        "x": 400,
        "y": 280,
        "wires": [
            [
                "bf720f2e31bd565f"
            ]
        ]
    },
    {
        "id": "5afac07baef3483b",
        "type": "subflow:d353eec5835441c0",
        "z": "ed1d968f509a241a",
        "name": "throttle requests",
        "env": [],
        "x": 400,
        "y": 320,
        "wires": [
            [
                "86c6a848cc148a02"
            ]
        ]
    },
    {
        "id": "a40c7340e5fbfef8",
        "type": "subflow:d353eec5835441c0",
        "z": "ed1d968f509a241a",
        "name": "throttle requests",
        "env": [],
        "x": 400,
        "y": 600,
        "wires": [
            [
                "2de42969e58fa460"
            ]
        ]
    },
    {
        "id": "a5a1bd7a98d4a993",
        "type": "subflow:d353eec5835441c0",
        "z": "ed1d968f509a241a",
        "name": "throttle requests",
        "env": [],
        "x": 400,
        "y": 440,
        "wires": [
            [
                "dc5687c51e9fecfa"
            ]
        ]
    },
    {
        "id": "33711c0523948df7",
        "type": "subflow:d353eec5835441c0",
        "z": "ed1d968f509a241a",
        "name": "throttle requests",
        "env": [],
        "x": 400,
        "y": 560,
        "wires": [
            [
                "3d88dfe4df13ea2d"
            ]
        ]
    },
    {
        "id": "672dae26ade75533",
        "type": "subflow:d353eec5835441c0",
        "z": "ed1d968f509a241a",
        "name": "throttle requests",
        "env": [],
        "x": 400,
        "y": 940,
        "wires": [
            [
                "878646332f28d3d3"
            ]
        ]
    },
    {
        "id": "9880d8bf6a202db7",
        "type": "subflow:d353eec5835441c0",
        "z": "ed1d968f509a241a",
        "name": "throttle requests",
        "env": [],
        "x": 400,
        "y": 1000,
        "wires": [
            [
                "cb73fef320f86a0a"
            ]
        ]
    },
    {
        "id": "ef627abb865f90b4",
        "type": "subflow:d353eec5835441c0",
        "z": "ed1d968f509a241a",
        "name": "throttle requests",
        "env": [],
        "x": 400,
        "y": 1060,
        "wires": [
            [
                "41120e6782e2a5f8"
            ]
        ]
    },
    {
        "id": "e75c16ed3a2a8728",
        "type": "subflow:d353eec5835441c0",
        "z": "ed1d968f509a241a",
        "name": "throttle requests",
        "env": [],
        "x": 400,
        "y": 1180,
        "wires": [
            [
                "af3f3488f9807b0a"
            ]
        ]
    },
    {
        "id": "1ba768c6f5c4ce02",
        "type": "subflow:d353eec5835441c0",
        "z": "ed1d968f509a241a",
        "name": "throttle requests",
        "env": [],
        "x": 400,
        "y": 1240,
        "wires": [
            [
                "4475037a98e468ec"
            ]
        ]
    },
    {
        "id": "999e2deb414d9ce8",
        "type": "subflow:d353eec5835441c0",
        "z": "ed1d968f509a241a",
        "name": "throttle requests",
        "env": [],
        "x": 400,
        "y": 1300,
        "wires": [
            [
                "cdbd05862cd8c88e"
            ]
        ]
    },
    {
        "id": "97225dcb6061b884",
        "type": "http in",
        "z": "ed1d968f509a241a",
        "name": "",
        "url": "/articles/id/:id",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 210,
        "y": 160,
        "wires": [
            [
                "7b39c0968ca2826a"
            ]
        ]
    },
    {
        "id": "7b39c0968ca2826a",
        "type": "subflow:d353eec5835441c0",
        "z": "ed1d968f509a241a",
        "name": "throttle requests",
        "env": [],
        "x": 400,
        "y": 160,
        "wires": [
            [
                "973df89602dc0c3d"
            ]
        ]
    },
    {
        "id": "973df89602dc0c3d",
        "type": "sqlstring-format",
        "z": "ed1d968f509a241a",
        "name": "",
        "query": "SELECT  * FROM articles where article_id = ? ORDER BY article_id DESC;",
        "vars": "req.params.id",
        "outField": "payload",
        "x": 690,
        "y": 160,
        "wires": [
            [
                "8089e901f648e1ac"
            ]
        ]
    },
    {
        "id": "8089e901f648e1ac",
        "type": "postgres",
        "z": "ed1d968f509a241a",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 1020,
        "y": 320,
        "wires": [
            [
                "6832ddc546050fc2",
                "48be7ebd82451c86"
            ]
        ]
    },
    {
        "id": "48be7ebd82451c86",
        "type": "debug",
        "z": "ed1d968f509a241a",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1300,
        "y": 60,
        "wires": []
    },
    {
        "id": "3749b6e93d13ae27",
        "type": "postgres",
        "z": "ed1d968f509a241a",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 720,
        "y": 980,
        "wires": [
            [
                "8bd6d1352c1b7e05",
                "c0a8bcb8b5eed125"
            ]
        ]
    },
    {
        "id": "706b5df9f6b21a41",
        "type": "postgres",
        "z": "ed1d968f509a241a",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 1020,
        "y": 1220,
        "wires": [
            [
                "0e03fd9c340c3244"
            ]
        ]
    },
    {
        "id": "3d236ffd51a7062e",
        "type": "inject",
        "z": "725b288ad1226693",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "172800",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "SELECT * FROM articles WHERE sent_to_admin IS NULL OR sent_to_admin =  false; ",
        "payloadType": "str",
        "x": 110,
        "y": 160,
        "wires": [
            [
                "878985223715b29c"
            ]
        ]
    },
    {
        "id": "19709fa3da7bc3a4",
        "type": "sqlite",
        "z": "725b288ad1226693",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "fixed",
        "sql": "SELECT * FROM articles WHERE sent_to_admin IS NULL OR sent_to_admin =  ''; ",
        "name": "",
        "x": 390,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "b8f8cf5a7f9f3373",
        "type": "template",
        "z": "725b288ad1226693",
        "name": "email template",
        "field": "text",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<h1>Digest of articles in the last 2 days</h1>\n<br>\n{{#payload}}\n\n\n\n<h2>{{{title}}}</h2>\n\n<p><strong>Discovery Date</strong>: {{discovery_date}}</p>\n\n<ul>\n    <li>ML GNB: {{ml_prediction_gnb}}</li>\n    <li>ML LR: {{ml_prediction_lr}}</li>\n</ul>\n\n<p>\n<a href=\"{{{link}}}\">{{{link}}}</a>\n</p>\n\n<p><a href=\"https://api.gregory-ms.com/articles/id/{{article_id}}/relevant/1\">Mark Relevant</a></p>\n\n<br>\n---\n<br>\n<br>\n{{/payload}}",
        "output": "str",
        "x": 660,
        "y": 160,
        "wires": [
            [
                "2e8b4fbf83509ea4"
            ]
        ]
    },
    {
        "id": "91bf7871b5902c4f",
        "type": "http request",
        "z": "725b288ad1226693",
        "name": "http request send mail",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "body",
        "url": "https://api.eu.mailgun.net/v3/mg.gregory-ms.com/messages",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "basic",
        "senderr": false,
        "x": 700,
        "y": 200,
        "wires": [
            [
                "4f162ef82dbf4ff2"
            ]
        ]
    },
    {
        "id": "2e8b4fbf83509ea4",
        "type": "change",
        "z": "725b288ad1226693",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "articles",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"from\":\"Gregory <gregory@mg.gregory-ms.com>\",\"to\":\"admins@mg.gregory-ms.com\",\"subject\":\"Gregory  Admin Summary\",\"multipart\":true}",
                "tot": "json"
            },
            {
                "t": "move",
                "p": "text",
                "pt": "msg",
                "to": "payload.html",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "headers",
                "pt": "msg",
                "to": "{\"content-type\":\"multipart/form-data\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 840,
        "y": 160,
        "wires": [
            [
                "91bf7871b5902c4f"
            ]
        ]
    },
    {
        "id": "1937e7e42c6b13c7",
        "type": "inject",
        "z": "725b288ad1226693",
        "d": true,
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "00 08 * * 2",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 110,
        "y": 440,
        "wires": [
            [
                "3ea73b308f1c969d"
            ]
        ]
    },
    {
        "id": "3ea73b308f1c969d",
        "type": "sqlite",
        "z": "725b288ad1226693",
        "d": true,
        "mydb": "9ccc1658.e12858",
        "sqlquery": "fixed",
        "sql": "SELECT *\nFROM articles\nWHERE sent_to_subscribers IS NULL\n    AND relevant = 1;",
        "name": "",
        "x": 290,
        "y": 440,
        "wires": [
            [
                "ebf412c0ad3516f8"
            ]
        ]
    },
    {
        "id": "67c923de501bfe87",
        "type": "template",
        "z": "725b288ad1226693",
        "d": true,
        "name": "",
        "field": "text",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<p>Good Morning, %recipient_fname%. </p>\n\n<p>Here are the relevant articles we have found in the last 7 days</p>\n\n{{#payload}}\n\n<h2>{{{title}}}</h2>\n\n<p><strong>Discovery Date</strong>: {{discovery_date}}</p>\n<p>\n<a href=\"{{{link}}}\">{{{link}}}</a>\n</p>\n\n---\n\n{{/payload}}\n\n<p>For the full list, please visit <a href=\"https://gregory-ms.com/\">https://gregory-ms.com/</a></p>\n\n<p>For adding people to this email list or further information, please contact Bruno Amaral:</p>\n\n<p><strong>Mobile</strong>: +351 912 875 856</p>\n\n<p><strong>Email</strong>: mail@brunoamaral.eu</p>\n\n<p>If you wish to unsubscribe, follow the link below.</p>\n\n<p>Best wishes, Gregory. Your friendly research bot.</p>\n",
        "output": "str",
        "x": 440,
        "y": 500,
        "wires": [
            [
                "eeab0cfe85fe434e"
            ]
        ]
    },
    {
        "id": "eeab0cfe85fe434e",
        "type": "change",
        "z": "725b288ad1226693",
        "d": true,
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "articles",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"from\":\"Gregory <gregory@mg.gregory-ms.com>\",\"to\":\"subscribers@mg.gregory-ms.com\",\"subject\":\"Gregory  Weekly Summary\",\"multipart\":true}",
                "tot": "json"
            },
            {
                "t": "move",
                "p": "text",
                "pt": "msg",
                "to": "payload.html",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "headers",
                "pt": "msg",
                "to": "{\"content-type\":\"multipart/form-data\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 500,
        "wires": [
            [
                "c64ea3f91bfee316"
            ]
        ]
    },
    {
        "id": "ebf412c0ad3516f8",
        "type": "switch",
        "z": "725b288ad1226693",
        "d": true,
        "name": "check if empty",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "empty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 280,
        "y": 500,
        "wires": [
            [
                "67c923de501bfe87"
            ],
            []
        ]
    },
    {
        "id": "c64ea3f91bfee316",
        "type": "http request",
        "z": "725b288ad1226693",
        "d": true,
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "body",
        "url": "https://api.eu.mailgun.net/v3/mg.gregory-ms.com/messages",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "basic",
        "senderr": false,
        "x": 810,
        "y": 500,
        "wires": [
            [
                "e9b5511880c3d65c"
            ]
        ]
    },
    {
        "id": "e9b5511880c3d65c",
        "type": "switch",
        "z": "725b288ad1226693",
        "d": true,
        "name": "statusCode=200?",
        "property": "statusCode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "200",
                "vt": "num"
            },
            {
                "t": "neq",
                "v": "200",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 990,
        "y": 500,
        "wires": [
            [
                "16b6a2de114979de"
            ],
            []
        ]
    },
    {
        "id": "ad7676f5da2abc74",
        "type": "comment",
        "z": "725b288ad1226693",
        "name": "Admin summary every 48h",
        "info": "",
        "x": 130,
        "y": 120,
        "wires": []
    },
    {
        "id": "25045b3f80b3c6d2",
        "type": "comment",
        "z": "725b288ad1226693",
        "name": "Weekly summary of relevant articles to the mailing list (Tuesday 8:00)",
        "info": "",
        "x": 260,
        "y": 400,
        "wires": []
    },
    {
        "id": "4f162ef82dbf4ff2",
        "type": "template",
        "z": "725b288ad1226693",
        "name": "SQLite template",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "UPDATE articles\nSET sent_to_admin = \"1\"\nWHERE article_id IN (\n\n{{#articles}}\n{{article_id}},\n{{/articles}}\n1\n\n);",
        "output": "str",
        "x": 900,
        "y": 200,
        "wires": [
            [
                "2191f3289fec63b8"
            ]
        ]
    },
    {
        "id": "2191f3289fec63b8",
        "type": "sqlite",
        "z": "725b288ad1226693",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 1090,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "be712a5e45bebe50",
        "type": "switch",
        "z": "725b288ad1226693",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "empty"
            },
            {
                "t": "nempty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 490,
        "y": 160,
        "wires": [
            [],
            [
                "b8f8cf5a7f9f3373"
            ]
        ]
    },
    {
        "id": "c96cfe44bb937017",
        "type": "inject",
        "z": "725b288ad1226693",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "86400",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "SELECT *  FROM trials  WHERE sent_to_admin IS NULL OR sent_to_admin = false",
        "payloadType": "str",
        "x": 170,
        "y": 1160,
        "wires": [
            [
                "943513b59965cf29"
            ]
        ]
    },
    {
        "id": "81eb0f0a0eba6294",
        "type": "split",
        "z": "725b288ad1226693",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "key",
        "x": 550,
        "y": 1220,
        "wires": [
            [
                "75f8d3a8a1896086"
            ]
        ]
    },
    {
        "id": "75f8d3a8a1896086",
        "type": "template",
        "z": "725b288ad1226693",
        "name": "SQLite template",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "UPDATE trials\nSET sent_to_admin = true\nWHERE trial_id = {{payload.trial_id}};",
        "output": "str",
        "x": 700,
        "y": 1220,
        "wires": [
            [
                "3bd7e22581368591"
            ]
        ]
    },
    {
        "id": "654521b6dd0e2649",
        "type": "comment",
        "z": "725b288ad1226693",
        "name": "Notify admin of new clinical trials",
        "info": "",
        "x": 230,
        "y": 1100,
        "wires": []
    },
    {
        "id": "9b658d5e237c51e7",
        "type": "http request",
        "z": "725b288ad1226693",
        "name": "http request send mail",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "body",
        "url": "https://api.eu.mailgun.net/v3/gregory-ms.com/messages",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "basic",
        "x": 960,
        "y": 1160,
        "wires": [
            [
                "b500ee46c3679d09"
            ]
        ]
    },
    {
        "id": "b500ee46c3679d09",
        "type": "template",
        "z": "725b288ad1226693",
        "name": "SQLite template",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "UPDATE trials\nSET sent_to_admin = true\nWHERE trial_id IN (\n\n{{#trials}}\n{{trial_id}},\n{{/trials}}\n1\n\n);",
        "output": "str",
        "x": 1160,
        "y": 1160,
        "wires": [
            [
                "3bd7e22581368591"
            ]
        ]
    },
    {
        "id": "3bd7e22581368591",
        "type": "sqlite",
        "z": "725b288ad1226693",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 1150,
        "y": 1220,
        "wires": [
            []
        ]
    },
    {
        "id": "5db23d93543a15b2",
        "type": "template",
        "z": "725b288ad1226693",
        "name": "email template",
        "field": "text",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<h1>Digest of trials in the last 2 days</h1>\n<br>\n{{#payload}}\n\n\n<br>\n<h2>{{{title}}}</h2>\n\n<p><strong>Discovery Date</strong>: {{discovery_date}}</p>\n<p>\n<a href=\"{{{link}}}\">{{{link}}}</a>\n</p>\n\n<br>\n---\n<br>\n<br>\n{{/payload}}",
        "output": "str",
        "x": 580,
        "y": 1160,
        "wires": [
            [
                "860bb27f2d7d2e7d"
            ]
        ]
    },
    {
        "id": "1875cf4e089b9eca",
        "type": "switch",
        "z": "725b288ad1226693",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "empty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 390,
        "y": 1200,
        "wires": [
            [
                "5db23d93543a15b2",
                "81eb0f0a0eba6294"
            ],
            []
        ]
    },
    {
        "id": "860bb27f2d7d2e7d",
        "type": "change",
        "z": "725b288ad1226693",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"from\":\"gregory@mg.brunoamaral.net\",\"to\":\"labs@mg.brunoamaral.net\",\"subject\":\"Gregory  Admin Summary\",\"multipart\":true}",
                "tot": "json"
            },
            {
                "t": "move",
                "p": "text",
                "pt": "msg",
                "to": "payload.html",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 760,
        "y": 1160,
        "wires": [
            [
                "9b658d5e237c51e7"
            ]
        ]
    },
    {
        "id": "16b6a2de114979de",
        "type": "template",
        "z": "725b288ad1226693",
        "d": true,
        "name": "SQLite template",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "UPDATE articles\nSET sent_to_subscribers = \"1\"\nWHERE article_id IN (\n\n{{#articles}}\n{{article_id}},\n{{/articles}}\n1\n\n);\n\n",
        "output": "str",
        "x": 1000,
        "y": 540,
        "wires": [
            [
                "3ba5c90884e5759d"
            ]
        ]
    },
    {
        "id": "3ba5c90884e5759d",
        "type": "sqlite",
        "z": "725b288ad1226693",
        "d": true,
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 1190,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "1d30210e2f536565",
        "type": "comment",
        "z": "725b288ad1226693",
        "name": "SETUP INSTRUCTIONS",
        "info": "Emails are sent using mailgun, you should sign up for an account or use these flows as an example.",
        "x": 130,
        "y": 40,
        "wires": []
    },
    {
        "id": "b31066be5a4819ea",
        "type": "inject",
        "z": "725b288ad1226693",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "00 08 * * 2",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 110,
        "y": 580,
        "wires": [
            [
                "1213050a8da3461d",
                "da45d2aa49d72ad2"
            ]
        ]
    },
    {
        "id": "1213050a8da3461d",
        "type": "change",
        "z": "725b288ad1226693",
        "name": "Set path = articles",
        "rules": [
            {
                "t": "set",
                "p": "paths",
                "pt": "msg",
                "to": "articles",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "SELECT * FROM articles WHERE sent_to_subscribers IS NULL OR sent_to_subscribers = FALSE     AND relevant = 1;",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 580,
        "wires": [
            [
                "9375313119723f3b"
            ]
        ]
    },
    {
        "id": "da45d2aa49d72ad2",
        "type": "change",
        "z": "725b288ad1226693",
        "name": "Set path = trials",
        "rules": [
            {
                "t": "set",
                "p": "paths",
                "pt": "msg",
                "to": "trials",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "SELECT *  FROM trials  WHERE sent_to_subscribers IS NULL OR sent_to_subscribers = FALSE ;",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 760,
        "wires": [
            [
                "79b2e5db731a082a"
            ]
        ]
    },
    {
        "id": "01b4f8431e959a60",
        "type": "switch",
        "z": "725b288ad1226693",
        "name": "check if empty",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "empty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 560,
        "y": 640,
        "wires": [
            [
                "d6279453190994ca"
            ],
            []
        ]
    },
    {
        "id": "611c45252554d613",
        "type": "switch",
        "z": "725b288ad1226693",
        "name": "if not empty",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "empty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 530,
        "y": 800,
        "wires": [
            [
                "d6279453190994ca"
            ],
            []
        ]
    },
    {
        "id": "d6279453190994ca",
        "type": "join-wait",
        "z": "725b288ad1226693",
        "name": "",
        "paths": "[\"articles\", \"trials\"]",
        "pathsToExpire": "",
        "useRegex": false,
        "warnUnmatched": false,
        "pathTopic": "paths",
        "pathTopicType": "msg",
        "correlationTopic": "",
        "correlationTopicType": "msg",
        "timeout": "5",
        "timeoutUnits": "1000",
        "exactOrder": "false",
        "firstMsg": "true",
        "mapPayload": "true",
        "disableComplete": false,
        "persistOnRestart": false,
        "x": 740,
        "y": 720,
        "wires": [
            [
                "54d3f934c3fe731d"
            ],
            []
        ]
    },
    {
        "id": "54d3f934c3fe731d",
        "type": "change",
        "z": "725b288ad1226693",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "paths.articles",
                "pt": "msg",
                "to": "articles",
                "tot": "msg"
            },
            {
                "t": "move",
                "p": "paths.trials",
                "pt": "msg",
                "to": "trials",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 900,
        "y": 720,
        "wires": [
            [
                "428807e8c991131b"
            ]
        ]
    },
    {
        "id": "428807e8c991131b",
        "type": "template",
        "z": "725b288ad1226693",
        "name": "email template",
        "field": "text",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!doctype html>\n<html>\n  <head>\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n    <title>Gregory MS update</title>\n    <style>\n@media only screen and (max-width: 620px) {\n  table.body h1 {\n    font-size: 28px !important;\n    margin-bottom: 10px !important;\n  }\n\n  table.body p,\ntable.body ul,\ntable.body ol,\ntable.body td,\ntable.body span,\ntable.body a {\n    font-size: 16px !important;\n  }\n\n  table.body .wrapper,\ntable.body .article {\n    padding: 10px !important;\n  }\n\n  table.body .content {\n    padding: 0 !important;\n  }\n\n  table.body .container {\n    padding: 0 !important;\n    width: 100% !important;\n  }\n\n  table.body .main {\n    border-left-width: 0 !important;\n    border-radius: 0 !important;\n    border-right-width: 0 !important;\n  }\n\n  table.body .btn table {\n    width: 100% !important;\n  }\n\n  table.body .btn a {\n    width: 100% !important;\n  }\n\n  table.body .img-responsive {\n    height: auto !important;\n    max-width: 100% !important;\n    width: auto !important;\n  }\n}\n@media all {\n  .ExternalClass {\n    width: 100%;\n  }\n\n  .ExternalClass,\n.ExternalClass p,\n.ExternalClass span,\n.ExternalClass font,\n.ExternalClass td,\n.ExternalClass div {\n    line-height: 100%;\n  }\n\n  .apple-link a {\n    color: inherit !important;\n    font-family: inherit !important;\n    font-size: inherit !important;\n    font-weight: inherit !important;\n    line-height: inherit !important;\n    text-decoration: none !important;\n  }\n\n  #MessageViewBody a {\n    color: inherit;\n    text-decoration: none;\n    font-size: inherit;\n    font-family: inherit;\n    font-weight: inherit;\n    line-height: inherit;\n  }\n\n  .btn-primary table td:hover {\n    background-color: #34495e !important;\n  }\n\n  .btn-primary a:hover {\n    background-color: #34495e !important;\n    border-color: #34495e !important;\n  }\n}\n</style>\n  </head>\n  <body class=\"\" style=\"background-color: #f6f6f6; font-family: sans-serif; -webkit-font-smoothing: antialiased; font-size: 14px; line-height: 1.4; margin: 0; padding: 0; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;\">\n    <span class=\"preheader\" style=\"color: transparent; display: none; height: 0; max-height: 0; max-width: 0; opacity: 0; overflow: hidden; mso-hide: all; visibility: hidden; width: 0;\">List of articles and new trials this week.</span>\n    <table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" class=\"body\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #f6f6f6; width: 100%;\" width=\"100%\" bgcolor=\"#f6f6f6\">\n      <tr>\n        <td style=\"font-family: sans-serif; font-size: 14px; vertical-align: top;\" valign=\"top\">&nbsp;</td>\n        <td class=\"container\" style=\"font-family: sans-serif; font-size: 14px; vertical-align: top; display: block; max-width: 580px; padding: 10px; width: 580px; margin: 0 auto;\" width=\"580\" valign=\"top\">\n          <div class=\"content\" style=\"box-sizing: border-box; display: block; margin: 0 auto; max-width: 580px; padding: 10px;\">\n\n            <!-- START CENTERED WHITE CONTAINER -->\n            <table role=\"presentation\" class=\"main\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background: #ffffff; border-radius: 3px; width: 100%;\" width=\"100%\">\n\n              <!-- START MAIN CONTENT AREA -->\n              <tr>\n                <td class=\"wrapper\" style=\"font-family: sans-serif; font-size: 14px; vertical-align: top; box-sizing: border-box; padding: 20px;\" valign=\"top\">\n                  <table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;\" width=\"100%\">\n                    <tr>\n                      <td style=\"font-family: sans-serif; font-size: 14px; vertical-align: top;\" valign=\"top\">\n                        <p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;\">Good Morning, %recipient_fname%, </p>\n                        <p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;\">Here are the relevant articles we have found in the last 7 days</p>\n\n                        <h2 style=\"color: #0f74c0; font-family: sans-serif; font-weight: 700; line-height: 1.4; margin: 0; margin-bottom: 30px;\">New Articles</h2>\n                        {{#articles}}\n\n                        <h2 style=\"color: #000000; font-family: sans-serif; font-weight: 400; line-height: 1.4; margin: 0; margin-bottom: 30px;\">{{{title}}}</h2>\n\n                        <p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;\"><strong>Discovery Date</strong>: {{discovery_date}}</p>\n                        <p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;\">\n                        <a href=\"{{{link}}}\" style=\"color: #3498db; text-decoration: underline;\">{{{link}}}</a>\n                        </p>\n\n                        <hr>\n\n                        {{/articles}}\n\n                        <h2 style=\"color: #0f74c0; font-family: sans-serif; font-weight: 700; line-height: 1.4; margin: 0; margin-bottom: 30px;\">New Trials</h2>\n\n                        {{#trials}}\n\n                        <h2 style=\"color: #000000; font-family: sans-serif; font-weight: 400; line-height: 1.4; margin: 0; margin-bottom: 30px;\">{{{title}}}</h2>\n\n                        <p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;\"><strong>Discovery Date</strong>: {{discovery_date}}</p>\n                        <p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;\">\n                        <a href=\"{{link}}\" style=\"color: #3498db; text-decoration: underline;\">{{{link}}}</a>\n                        </p>\n\n                        <hr>\n\n                        {{/trials}}\n                        <p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;\">For the full list, please visit <a href=\"https://gregory-ms.com/\" style=\"color: #3498db; text-decoration: underline;\">https://gregory-ms.com/</a></p>\n\n                        <p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;\">For adding people to this email list or further information, please contact Bruno Amaral:</p>\n\n                        <p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;\"><strong>Mobile</strong>: +351 912 875 856</p>\n\n                        <p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;\"><strong>Email</strong>: mail@brunoamaral.eu</p>\n\n                        <p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;\">If you wish to unsubscribe, follow the link below.</p>\n\n                        <p style=\"font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;\">Best wishes fomyour friendly research bot.<br><strong>Gregory</strong></p>\n\n                      </td>\n                    </tr>\n                  </table>\n                </td>\n              </tr>\n\n            <!-- END MAIN CONTENT AREA -->\n            </table>\n            <!-- END CENTERED WHITE CONTAINER -->\n\n            <!-- START FOOTER -->\n            <div class=\"footer\" style=\"clear: both; margin-top: 10px; text-align: center; width: 100%;\">\n              <table role=\"presentation\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" style=\"border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;\" width=\"100%\">\n                <tr>\n                  <td class=\"content-block\" style=\"font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;\" valign=\"top\" align=\"center\">\n                    <span class=\"apple-link\" style=\"color: #999999; font-size: 12px; text-align: center;\">Gregory MS</span>\n                    <br> For more information visit <a href=\"https://gregory-ms.com/\" style=\"text-decoration: underline; color: #999999; font-size: 12px; text-align: center;\">https://gregory-ms.com/</a>.\n                  </td>\n                </tr>\n                <tr>\n                  <td class=\"content-block powered-by\" style=\"font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;\" valign=\"top\" align=\"center\">\n                    Powered by <a href=\"http://htmlemail.io\" style=\"color: #999999; font-size: 12px; text-align: center; text-decoration: none;\">HTMLemail</a>.\n                  </td>\n                </tr>\n              </table>\n            </div>\n            <!-- END FOOTER -->\n\n          </div>\n        </td>\n        <td style=\"font-family: sans-serif; font-size: 14px; vertical-align: top;\" valign=\"top\">&nbsp;</td>\n      </tr>\n    </table>\n  </body>\n</html>",
        "output": "str",
        "x": 800,
        "y": 760,
        "wires": [
            [
                "d2b85fd5322dc9b6"
            ]
        ]
    },
    {
        "id": "09329519da5f92a7",
        "type": "template",
        "z": "725b288ad1226693",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "UPDATE articles\nSET sent_to_subscribers = true\nWHERE article_id IN (\n\n{{#articles}}\n{{article_id}},\n{{/articles}}\n1\n\n);\n\nUPDATE trials\nSET sent_to_subscribers = true\nWHERE trial_id IN (\n\n{{#trials}}\n{{trial_id}},\n{{/trials}}\n1\n\n);",
        "output": "str",
        "x": 1160,
        "y": 800,
        "wires": [
            [
                "19747ac769deac36"
            ]
        ]
    },
    {
        "id": "d2b85fd5322dc9b6",
        "type": "change",
        "z": "725b288ad1226693",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "oldpayload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"from\":\"Gregory <gregory@mg.gregory-ms.com>\",\"to\":\"subscribers@mg.gregory-ms.com\",\"subject\":\"Gregory  Weekly Summary\",\"multipart\":true}",
                "tot": "json"
            },
            {
                "t": "move",
                "p": "text",
                "pt": "msg",
                "to": "payload.html",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "headers",
                "pt": "msg",
                "to": "{\"content-type\":\"multipart/form-data\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1000,
        "y": 760,
        "wires": [
            [
                "9af470fda565ae4f"
            ]
        ]
    },
    {
        "id": "9af470fda565ae4f",
        "type": "http request",
        "z": "725b288ad1226693",
        "name": "",
        "method": "POST",
        "ret": "obj",
        "paytoqs": "body",
        "url": "https://api.eu.mailgun.net/v3/mg.gregory-ms.com/messages",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "basic",
        "senderr": false,
        "x": 810,
        "y": 800,
        "wires": [
            [
                "0fb79b49bfe7a99c"
            ]
        ]
    },
    {
        "id": "0fb79b49bfe7a99c",
        "type": "switch",
        "z": "725b288ad1226693",
        "name": "statusCode=200?",
        "property": "statusCode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "200",
                "vt": "num"
            },
            {
                "t": "neq",
                "v": "200",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 990,
        "y": 800,
        "wires": [
            [
                "09329519da5f92a7"
            ],
            []
        ]
    },
    {
        "id": "878985223715b29c",
        "type": "postgres",
        "z": "725b288ad1226693",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 320,
        "y": 160,
        "wires": [
            [
                "be712a5e45bebe50"
            ]
        ]
    },
    {
        "id": "9375313119723f3b",
        "type": "postgres",
        "z": "725b288ad1226693",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 400,
        "y": 640,
        "wires": [
            [
                "01b4f8431e959a60"
            ]
        ]
    },
    {
        "id": "79b2e5db731a082a",
        "type": "postgres",
        "z": "725b288ad1226693",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 360,
        "y": 800,
        "wires": [
            [
                "611c45252554d613"
            ]
        ]
    },
    {
        "id": "19747ac769deac36",
        "type": "postgres",
        "z": "725b288ad1226693",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 1340,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "943513b59965cf29",
        "type": "postgres",
        "z": "725b288ad1226693",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 260,
        "y": 1200,
        "wires": [
            [
                "1875cf4e089b9eca"
            ]
        ]
    },
    {
        "id": "70b6e3e4a833d450",
        "type": "inject",
        "z": "3645fb833bf0fede",
        "name": "GO!",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "3600",
        "crontab": "",
        "once": true,
        "onceDelay": "600",
        "topic": "",
        "payload": "https://api.gregory-ms.com/articles/prediction/none",
        "payloadType": "str",
        "x": 90,
        "y": 160,
        "wires": [
            [
                "9e199b6441bf61be"
            ]
        ]
    },
    {
        "id": "342bd369d2e46572",
        "type": "json",
        "z": "3645fb833bf0fede",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 830,
        "y": 240,
        "wires": [
            [
                "3c22a9cd79ebdfd9",
                "076aeb0139c0cbfd"
            ]
        ]
    },
    {
        "id": "7d35621d66992c95",
        "type": "http in",
        "z": "3645fb833bf0fede",
        "name": "",
        "url": "/articles/prediction/none",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 80,
        "wires": [
            [
                "41edbf09ba311024"
            ]
        ]
    },
    {
        "id": "31d9cd8cc41435ee",
        "type": "http response",
        "z": "3645fb833bf0fede",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 850,
        "y": 80,
        "wires": []
    },
    {
        "id": "076aeb0139c0cbfd",
        "type": "template",
        "z": "3645fb833bf0fede",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "{{#payload.models.gnb}}\nUPDATE articles SET ml_prediction_gnb = {{prediction}} WHERE article_id = {{article_id}};\n{{/payload.models.gnb}}\n\n{{#payload.models.lr}}\nUPDATE articles SET ml_prediction_lr = {{prediction}} WHERE article_id = {{article_id}};\n{{/payload.models.lr}}",
        "output": "str",
        "x": 1020,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "147fc09265d87c6d",
        "type": "exec",
        "z": "3645fb833bf0fede",
        "command": "/usr/bin/python3 /python-ml/3_predict.py ",
        "addpay": "responseUrl",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 600,
        "y": 260,
        "wires": [
            [
                "342bd369d2e46572",
                "9416ca2afd5af084"
            ],
            [
                "9416ca2afd5af084"
            ],
            [
                "9416ca2afd5af084"
            ]
        ]
    },
    {
        "id": "9e199b6441bf61be",
        "type": "http request",
        "z": "3645fb833bf0fede",
        "name": "get articles to run predictions",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.gregory-ms.com/articles/prediction/none",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 240,
        "y": 220,
        "wires": [
            [
                "771f4e4fa0d41ea3"
            ]
        ]
    },
    {
        "id": "771f4e4fa0d41ea3",
        "type": "switch",
        "z": "3645fb833bf0fede",
        "name": "check for resullts",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "[]",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "[]",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 530,
        "y": 200,
        "wires": [
            [
                "147fc09265d87c6d",
                "9416ca2afd5af084"
            ],
            []
        ]
    },
    {
        "id": "03f16c58395670ae",
        "type": "rss",
        "z": "3645fb833bf0fede",
        "name": "",
        "feedOptionRules": [
            {
                "name": "title",
                "type": "str",
                "value": "Gregory"
            },
            {
                "name": "site_url",
                "type": "str",
                "value": "https://gregory-ms.com/"
            },
            {
                "name": "feed_url",
                "type": "str",
                "value": "https://api.gregory-ms.com/machine-learning/feed"
            }
        ],
        "itemOptionRules": [
            {
                "name": "custom_elements.id",
                "type": "item",
                "value": "article_id"
            },
            {
                "name": "title",
                "type": "item",
                "value": "title"
            },
            {
                "name": "url",
                "type": "item",
                "value": "link"
            },
            {
                "name": "description",
                "type": "item",
                "value": "summary"
            },
            {
                "name": "date",
                "type": "item",
                "value": "discovery_date"
            },
            {
                "name": "guid",
                "type": "item",
                "value": "article_id"
            }
        ],
        "x": 710,
        "y": 420,
        "wires": [
            [
                "7e0bd82526892c37"
            ]
        ]
    },
    {
        "id": "abb8c31091268e38",
        "type": "http in",
        "z": "3645fb833bf0fede",
        "name": "",
        "url": "/machine-learning/feed",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 420,
        "wires": [
            [
                "8bc3c31e62ed8d35"
            ]
        ]
    },
    {
        "id": "7e0bd82526892c37",
        "type": "http response",
        "z": "3645fb833bf0fede",
        "name": "",
        "statusCode": "200",
        "headers": {
            "content-type": "application/rss+xml"
        },
        "x": 840,
        "y": 420,
        "wires": []
    },
    {
        "id": "7b2e646eddf2d932",
        "type": "http request",
        "z": "3645fb833bf0fede",
        "name": "get all articles",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.gregory-ms.com/articles/all",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 280,
        "y": 260,
        "wires": [
            [
                "771f4e4fa0d41ea3"
            ]
        ]
    },
    {
        "id": "cb4392e425a071e2",
        "type": "inject",
        "z": "3645fb833bf0fede",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 120,
        "y": 260,
        "wires": [
            [
                "7b2e646eddf2d932"
            ]
        ]
    },
    {
        "id": "3c22a9cd79ebdfd9",
        "type": "debug",
        "z": "3645fb833bf0fede",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 240,
        "wires": []
    },
    {
        "id": "2423fda83c547982",
        "type": "exec",
        "z": "3645fb833bf0fede",
        "g": "73e7742c5dcd5260",
        "command": "/usr/bin/python3 /python-ml/noun_phrases.py",
        "addpay": "title",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 300,
        "y": 820,
        "wires": [
            [
                "3cd3c17a6de731d3"
            ],
            [],
            []
        ]
    },
    {
        "id": "2f5030f323b8b823",
        "type": "inject",
        "z": "3645fb833bf0fede",
        "g": "73e7742c5dcd5260",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "3600",
        "crontab": "",
        "once": true,
        "onceDelay": "666",
        "topic": "",
        "payloadType": "date",
        "x": 130,
        "y": 560,
        "wires": [
            [
                "3ed1ccd784978698"
            ]
        ]
    },
    {
        "id": "359543a807cae46a",
        "type": "change",
        "z": "3645fb833bf0fede",
        "g": "73e7742c5dcd5260",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "title",
                "pt": "msg",
                "to": "payload[0].title",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article_id",
                "pt": "msg",
                "to": "payload[0].article_id",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 720,
        "wires": [
            [
                "7662c7bb58cc6bb1"
            ]
        ]
    },
    {
        "id": "7662c7bb58cc6bb1",
        "type": "template",
        "z": "3645fb833bf0fede",
        "g": "73e7742c5dcd5260",
        "name": "",
        "field": "title",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "\"{{{title}}}\"",
        "output": "str",
        "x": 160,
        "y": 760,
        "wires": [
            [
                "2423fda83c547982"
            ]
        ]
    },
    {
        "id": "402c42b3d9b92524",
        "type": "template",
        "z": "3645fb833bf0fede",
        "g": "73e7742c5dcd5260",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "update articles set noun_phrases = '{{{payload}}}' where article_id = {{article_id}};",
        "output": "str",
        "x": 600,
        "y": 840,
        "wires": [
            [
                "930cf22afddf0c30"
            ]
        ]
    },
    {
        "id": "3cd3c17a6de731d3",
        "type": "change",
        "z": "3645fb833bf0fede",
        "g": "73e7742c5dcd5260",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$trim(payload)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 600,
        "y": 800,
        "wires": [
            [
                "402c42b3d9b92524"
            ]
        ]
    },
    {
        "id": "e33b69b3a1d02f35",
        "type": "comment",
        "z": "3645fb833bf0fede",
        "g": "73e7742c5dcd5260",
        "name": "identify noun phrases",
        "info": "",
        "x": 840,
        "y": 560,
        "wires": []
    },
    {
        "id": "508f690c259db91d",
        "type": "delay",
        "z": "3645fb833bf0fede",
        "g": "73e7742c5dcd5260",
        "name": "",
        "pauseType": "delay",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 610,
        "y": 580,
        "wires": [
            [
                "3ed1ccd784978698"
            ]
        ]
    },
    {
        "id": "e9cf7800e5bd2027",
        "type": "switch",
        "z": "3645fb833bf0fede",
        "g": "73e7742c5dcd5260",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 150,
        "y": 720,
        "wires": [
            [
                "359543a807cae46a"
            ]
        ]
    },
    {
        "id": "9416ca2afd5af084",
        "type": "debug",
        "z": "3645fb833bf0fede",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 980,
        "y": 160,
        "wires": []
    },
    {
        "id": "d387f4edde9edd4c",
        "type": "inject",
        "z": "3645fb833bf0fede",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "259200",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 110,
        "y": 980,
        "wires": [
            [
                "3ae07dc9802b9fa2"
            ]
        ]
    },
    {
        "id": "3ae07dc9802b9fa2",
        "type": "exec",
        "z": "3645fb833bf0fede",
        "command": "/usr/bin/python3 /python-ml/1_data_processor.py",
        "addpay": "",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 390,
        "y": 980,
        "wires": [
            [
                "06295a643dcb5668"
            ],
            [],
            []
        ]
    },
    {
        "id": "06295a643dcb5668",
        "type": "exec",
        "z": "3645fb833bf0fede",
        "command": "/usr/bin/python3 /python-ml/2_train_models.py",
        "addpay": "",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 800,
        "y": 980,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "520e21f8c3e9fe1d",
        "type": "comment",
        "z": "3645fb833bf0fede",
        "name": "retrain models every 72h",
        "info": "",
        "x": 140,
        "y": 940,
        "wires": []
    },
    {
        "id": "41edbf09ba311024",
        "type": "template",
        "z": "3645fb833bf0fede",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "SELECT * FROM  articles\nWHERE ( (summary != 'not available') AND (summary IS NOT NULL) AND (summary != '') )\nAND ml_prediction_gnb IS NULL ;\n\n",
        "output": "str",
        "x": 340,
        "y": 80,
        "wires": [
            [
                "4e4a1649bce23baf"
            ]
        ]
    },
    {
        "id": "4e4a1649bce23baf",
        "type": "postgres",
        "z": "3645fb833bf0fede",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 500,
        "y": 80,
        "wires": [
            [
                "31d9cd8cc41435ee"
            ]
        ]
    },
    {
        "id": "ac8989822a0d3ac1",
        "type": "postgres",
        "z": "3645fb833bf0fede",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 560,
        "y": 420,
        "wires": [
            [
                "03f16c58395670ae"
            ]
        ]
    },
    {
        "id": "8bc3c31e62ed8d35",
        "type": "change",
        "z": "3645fb833bf0fede",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": " select * from articles where ml_prediction_gnb = true order by article_id desc limit 10;",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 420,
        "wires": [
            [
                "ac8989822a0d3ac1"
            ]
        ]
    },
    {
        "id": "3ed1ccd784978698",
        "type": "change",
        "z": "3645fb833bf0fede",
        "g": "73e7742c5dcd5260",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "select title,article_id from articles where noun_phrases IS NULL limit 1;",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 210,
        "y": 640,
        "wires": [
            [
                "48da5fa9cbf7b652"
            ]
        ]
    },
    {
        "id": "48da5fa9cbf7b652",
        "type": "postgres",
        "z": "3645fb833bf0fede",
        "g": "73e7742c5dcd5260",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 190,
        "y": 680,
        "wires": [
            [
                "e9cf7800e5bd2027"
            ]
        ]
    },
    {
        "id": "930cf22afddf0c30",
        "type": "postgres",
        "z": "3645fb833bf0fede",
        "g": "73e7742c5dcd5260",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 780,
        "y": 840,
        "wires": [
            [
                "508f690c259db91d"
            ]
        ]
    },
    {
        "id": "d0a67570c56bb22a",
        "type": "function",
        "z": "96ed7d399250eb68",
        "name": "Prepare Notion DB payload",
        "func": "var data = msg.payload[0]\nvar title = msg.payload[0].title\nvar url = msg.payload[0].link\n\n\n\nvar postData = {\n\t\"parent\": { \"database_id\": \"4fa1dc37-a3bf-43be-9c8d-35b41e539f8d\" },\n\t\"properties\": {\n\t\t\"Name\": {\n\t\t\t\"title\": [\n\t\t\t\t{\n\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\"content\": title\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t},\n\t\t\"Status\": {\n\t\t    \"select\": {\n\t\t        \"name\": \"Auto\"\n\t\t    }\n\t\t},\n        \"Link\": {\n            \"url\": url\n        }\n\t\t\n}}\n\n\n\n//\t\t\"Context\": {\n//\t\t\t\"select\": {\n//\t\t\t\t\"name\": context\n//\t\t\t}\n//\t\t},\n//\t\t\"Client\": {\n//\t\t    \"select\": {\n//\t\t        \"name\": client\n//\t\t    }\n//\t\t}\n\nmsg.payload = postData\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 660,
        "y": 280,
        "wires": [
            [
                "1a7a475f77c5ec26"
            ]
        ]
    },
    {
        "id": "1a7a475f77c5ec26",
        "type": "http request",
        "z": "96ed7d399250eb68",
        "name": "create page",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.notion.com/v1/pages",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "bearer",
        "x": 930,
        "y": 280,
        "wires": [
            [
                "168edaf057910e19"
            ]
        ]
    },
    {
        "id": "168edaf057910e19",
        "type": "json",
        "z": "96ed7d399250eb68",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1070,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "16071421ebfe9be2",
        "type": "feedparse",
        "z": "96ed7d399250eb68",
        "name": "",
        "url": "https://api.gregory-ms.com/machine-learning/feed",
        "interval": "2",
        "x": 210,
        "y": 220,
        "wires": [
            [
                "a88d10b9b90080cc"
            ]
        ]
    },
    {
        "id": "a88d10b9b90080cc",
        "type": "change",
        "z": "96ed7d399250eb68",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "guid",
                "pt": "msg",
                "to": "article.guid",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 130,
        "y": 280,
        "wires": [
            [
                "898c8f923cb3f30f"
            ]
        ]
    },
    {
        "id": "898c8f923cb3f30f",
        "type": "rbe",
        "z": "96ed7d399250eb68",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "guid",
        "topi": "topic",
        "x": 270,
        "y": 280,
        "wires": [
            [
                "fffd4cf7b7fc3ef1"
            ]
        ]
    },
    {
        "id": "c10b4abbb4ece307",
        "type": "comment",
        "z": "96ed7d399250eb68",
        "name": "Publish Articles on Twitter",
        "info": "",
        "x": 130,
        "y": 180,
        "wires": []
    },
    {
        "id": "8a96eea3ac9e59a9",
        "type": "comment",
        "z": "96ed7d399250eb68",
        "name": "Save tweet in the content calendar so that Automate.io can publish it",
        "info": "",
        "x": 790,
        "y": 220,
        "wires": []
    },
    {
        "id": "fffd4cf7b7fc3ef1",
        "type": "delay",
        "z": "96ed7d399250eb68",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "5",
        "rateUnits": "minute",
        "randomFirst": "5",
        "randomLast": "6",
        "randomUnits": "minutes",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 420,
        "y": 280,
        "wires": [
            [
                "d0a67570c56bb22a"
            ]
        ]
    },
    {
        "id": "ab61a8b7965dba59",
        "type": "inject",
        "z": "96ed7d399250eb68",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "259200",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "SELECT COUNT(*) FROM articles;",
        "payloadType": "str",
        "x": 110,
        "y": 620,
        "wires": [
            [
                "13a9f75711c7bf14"
            ]
        ]
    },
    {
        "id": "c4b02860a8479328",
        "type": "change",
        "z": "96ed7d399250eb68",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0][\"COUNT(*)\"]",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 620,
        "wires": [
            [
                "0e8c2f25a0faebe3"
            ]
        ]
    },
    {
        "id": "07d461edea1ed608",
        "type": "function",
        "z": "96ed7d399250eb68",
        "name": "Prepare Notion DB payload",
        "func": "\nvar post = `I have found ${msg.payload} articles.`\n\nvar url = 'https://gregory-ms.com/articles/'\n\n\nvar postData = {\n\t\"parent\": { \"database_id\": \"4fa1dc37-a3bf-43be-9c8d-35b41e539f8d\" },\n\t\"properties\": {\n\t\t\"Name\": {\n\t\t\t\"title\": [\n\t\t\t\t{\n\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\"content\": post\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t},\n\t\t\"Status\": {\n\t\t    \"select\": {\n\t\t        \"name\": \"Auto\"\n\t\t    }\n\t\t},\n\t\t\"Link\": {\n            \"url\": url\n        }\n\t\t\n}}\n\n\n\n//\t\t\"Context\": {\n//\t\t\t\"select\": {\n//\t\t\t\t\"name\": context\n//\t\t\t}\n//\t\t},\n//\t\t\"Client\": {\n//\t\t    \"select\": {\n//\t\t        \"name\": client\n//\t\t    }\n//\t\t}\n\nmsg.payload = postData\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 830,
        "y": 620,
        "wires": [
            [
                "23bb07df17e84ee6"
            ]
        ]
    },
    {
        "id": "23bb07df17e84ee6",
        "type": "http request",
        "z": "96ed7d399250eb68",
        "name": "create page",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.notion.com/v1/pages",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "bearer",
        "x": 800,
        "y": 680,
        "wires": [
            [
                "0eafca4a90d69a3b"
            ]
        ]
    },
    {
        "id": "0eafca4a90d69a3b",
        "type": "json",
        "z": "96ed7d399250eb68",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 940,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "0e8c2f25a0faebe3",
        "type": "rbe",
        "z": "96ed7d399250eb68",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 620,
        "y": 620,
        "wires": [
            [
                "07d461edea1ed608"
            ]
        ]
    },
    {
        "id": "b09095829dd34114",
        "type": "inject",
        "z": "96ed7d399250eb68",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "2220",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "SELECT * FROM trials WHERE sent_to_twitter IS NULL OR sent_to_twitter = \"\" limit 1;",
        "payloadType": "str",
        "x": 110,
        "y": 860,
        "wires": [
            [
                "ddc6c90b52bd66fe"
            ]
        ]
    },
    {
        "id": "e0450ec969488fd8",
        "type": "template",
        "z": "96ed7d399250eb68",
        "name": "SQLite template",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "UPDATE trials\nSET sent_to_twitter = true\nWHERE trial_id = {{trial_id}};",
        "output": "str",
        "x": 940,
        "y": 940,
        "wires": [
            [
                "946a3f2dde7d1742"
            ]
        ]
    },
    {
        "id": "1ca6164f6b22651b",
        "type": "comment",
        "z": "96ed7d399250eb68",
        "name": "Post new clinical trials",
        "info": "",
        "x": 140,
        "y": 800,
        "wires": []
    },
    {
        "id": "7d3a6a479160e13a",
        "type": "switch",
        "z": "96ed7d399250eb68",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "empty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 510,
        "y": 860,
        "wires": [
            [
                "a44a4dfef2f4c4f1"
            ],
            []
        ]
    },
    {
        "id": "13ba6c6d5e4a805c",
        "type": "function",
        "z": "96ed7d399250eb68",
        "name": "Prepare Notion DB payload",
        "func": "var data = msg.payload[0]\nvar title = `#ClinicalTrial ${msg.payload[0].title} `\nvar url = msg.payload[0].link\n\nvar postData = {\n\t\"parent\": { \"database_id\": \"4fa1dc37-a3bf-43be-9c8d-35b41e539f8d\" },\n\t\"properties\": {\n\t\t\"Name\": {\n\t\t\t\"title\": [\n\t\t\t\t{\n\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\"content\": title\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t},\n\t\t\"Status\": {\n\t\t    \"select\": {\n\t\t        \"name\": \"Auto\"\n\t\t    }\n\t\t},\n        \"Link\": {\n            \"url\": url\n        }\n\t\t\n}}\n\n\n\n//\t\t\"Context\": {\n//\t\t\t\"select\": {\n//\t\t\t\t\"name\": context\n//\t\t\t}\n//\t\t},\n//\t\t\"Client\": {\n//\t\t    \"select\": {\n//\t\t        \"name\": client\n//\t\t    }\n//\t\t}\n\nmsg.payload = postData\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 940,
        "wires": [
            [
                "93bec05b2f532f43"
            ]
        ]
    },
    {
        "id": "93bec05b2f532f43",
        "type": "http request",
        "z": "96ed7d399250eb68",
        "name": "create page",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.notion.com/v1/pages",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "bearer",
        "x": 650,
        "y": 940,
        "wires": [
            [
                "18267b0d13e06d32"
            ]
        ]
    },
    {
        "id": "18267b0d13e06d32",
        "type": "json",
        "z": "96ed7d399250eb68",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 790,
        "y": 940,
        "wires": [
            [
                "e0450ec969488fd8"
            ]
        ]
    },
    {
        "id": "a44a4dfef2f4c4f1",
        "type": "change",
        "z": "96ed7d399250eb68",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload[0].trial_id",
                "pt": "msg",
                "to": "trial_id",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 180,
        "y": 940,
        "wires": [
            [
                "13ba6c6d5e4a805c"
            ]
        ]
    },
    {
        "id": "bdb12562dab0e2e6",
        "type": "sqlite",
        "z": "96ed7d399250eb68",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 350,
        "y": 1060,
        "wires": [
            [
                "4e3279127af72e0e"
            ]
        ]
    },
    {
        "id": "95e178c9da61672d",
        "type": "inject",
        "z": "96ed7d399250eb68",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "1020",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "SELECT article_id,ml_prediction_gnb,sent_to_twitter FROM articles WHERE ml_prediction_gnb = true and sent_to_twitter is null or sent_to_twitter = false limit 1;",
        "payloadType": "str",
        "x": 110,
        "y": 1060,
        "wires": [
            [
                "bdb12562dab0e2e6"
            ]
        ]
    },
    {
        "id": "1dbf7612aaaeb6bc",
        "type": "template",
        "z": "96ed7d399250eb68",
        "name": "SQLite template",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "UPDATE articles\nSET sent_to_twitter = true\nWHERE article_id = {{article_id}};",
        "output": "str",
        "x": 960,
        "y": 1140,
        "wires": [
            [
                "71a51b260d8e53d9"
            ]
        ]
    },
    {
        "id": "4fe9e0cc8d01df37",
        "type": "comment",
        "z": "96ed7d399250eb68",
        "name": "Post new articles",
        "info": "",
        "x": 120,
        "y": 1000,
        "wires": []
    },
    {
        "id": "4e3279127af72e0e",
        "type": "switch",
        "z": "96ed7d399250eb68",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "empty"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 530,
        "y": 1060,
        "wires": [
            [
                "e8afd013865fd70f"
            ],
            []
        ]
    },
    {
        "id": "1eda807cc03a65d4",
        "type": "function",
        "z": "96ed7d399250eb68",
        "name": "Prepare Notion DB payload",
        "func": "var data = msg.payload[0]\nvar title = `New article discovered, is it relevant? ${msg.payload[0].title} `\nvar url = msg.payload[0].link\n\nvar postData = {\n\t\"parent\": { \"database_id\": \"4fa1dc37-a3bf-43be-9c8d-35b41e539f8d\" },\n\t\"properties\": {\n\t\t\"Name\": {\n\t\t\t\"title\": [\n\t\t\t\t{\n\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\"content\": title\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t},\n\t\t\"Status\": {\n\t\t    \"select\": {\n\t\t        \"name\": \"Auto\"\n\t\t    }\n\t\t},\n        \"Link\": {\n            \"url\": url\n        }\n\t\t\n}}\n\n\n\n//\t\t\"Context\": {\n//\t\t\t\"select\": {\n//\t\t\t\t\"name\": context\n//\t\t\t}\n//\t\t},\n//\t\t\"Client\": {\n//\t\t    \"select\": {\n//\t\t        \"name\": client\n//\t\t    }\n//\t\t}\n\nmsg.payload = postData\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 1140,
        "wires": [
            [
                "b048cd17ebd5f94c"
            ]
        ]
    },
    {
        "id": "b048cd17ebd5f94c",
        "type": "http request",
        "z": "96ed7d399250eb68",
        "name": "create page",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.notion.com/v1/pages",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "bearer",
        "x": 670,
        "y": 1140,
        "wires": [
            [
                "2586c9fdc3bdad93"
            ]
        ]
    },
    {
        "id": "2586c9fdc3bdad93",
        "type": "json",
        "z": "96ed7d399250eb68",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 810,
        "y": 1140,
        "wires": [
            [
                "1dbf7612aaaeb6bc"
            ]
        ]
    },
    {
        "id": "e8afd013865fd70f",
        "type": "change",
        "z": "96ed7d399250eb68",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload[0].article_id",
                "pt": "msg",
                "to": "article_id",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 190,
        "y": 1140,
        "wires": [
            [
                "1eda807cc03a65d4"
            ]
        ]
    },
    {
        "id": "e4ba3651f70459d2",
        "type": "comment",
        "z": "96ed7d399250eb68",
        "name": "Count articles and publish on twitter",
        "info": "",
        "x": 180,
        "y": 560,
        "wires": []
    },
    {
        "id": "5c4e17e0698a26f4",
        "type": "comment",
        "z": "96ed7d399250eb68",
        "name": "EXAMPLE ONLY, do not use please",
        "info": "",
        "x": 160,
        "y": 60,
        "wires": []
    },
    {
        "id": "13a9f75711c7bf14",
        "type": "postgres",
        "z": "96ed7d399250eb68",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 260,
        "y": 620,
        "wires": [
            [
                "c4b02860a8479328"
            ]
        ]
    },
    {
        "id": "ddc6c90b52bd66fe",
        "type": "postgres",
        "z": "96ed7d399250eb68",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 240,
        "y": 860,
        "wires": [
            [
                "7d3a6a479160e13a"
            ]
        ]
    },
    {
        "id": "946a3f2dde7d1742",
        "type": "postgres",
        "z": "96ed7d399250eb68",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": false,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": false,
        "x": 1100,
        "y": 940,
        "wires": []
    },
    {
        "id": "71a51b260d8e53d9",
        "type": "postgres",
        "z": "96ed7d399250eb68",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": false,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": false,
        "x": 1140,
        "y": 1140,
        "wires": []
    },
    {
        "id": "dfd03a4d7f13f074",
        "type": "exec",
        "z": "73dc69858609cde2",
        "command": "/usr/bin/python3 /python-ml/1_data_processor.py ",
        "addpay": "",
        "append": "",
        "useSpawn": "true",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 390,
        "y": 180,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "461ea1fa83122ba3",
        "type": "inject",
        "z": "73dc69858609cde2",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 180,
        "wires": [
            [
                "dfd03a4d7f13f074"
            ]
        ]
    },
    {
        "id": "63298815da0415f9",
        "type": "inject",
        "z": "73dc69858609cde2",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 240,
        "wires": [
            [
                "7693f68c3c185f98"
            ]
        ]
    },
    {
        "id": "7693f68c3c185f98",
        "type": "exec",
        "z": "73dc69858609cde2",
        "command": "/usr/bin/python3 /python-ml/2_train_models.py",
        "addpay": "",
        "append": "",
        "useSpawn": "true",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 380,
        "y": 240,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "f5c751a82aa53f6b",
        "type": "inject",
        "z": "73dc69858609cde2",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 500,
        "wires": [
            [
                "a69e6c0e6f168ff6"
            ]
        ]
    },
    {
        "id": "a69e6c0e6f168ff6",
        "type": "sqlite",
        "z": "73dc69858609cde2",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "fixed",
        "sql": "select trial_id,published_date,discovery_date from trials where published_date = '' ;",
        "name": "",
        "x": 330,
        "y": 500,
        "wires": [
            [
                "5cc55f5e649cf407",
                "37091faefc948117"
            ]
        ]
    },
    {
        "id": "5cc55f5e649cf407",
        "type": "debug",
        "z": "73dc69858609cde2",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1010,
        "y": 440,
        "wires": []
    },
    {
        "id": "dac10b58551da14c",
        "type": "template",
        "z": "73dc69858609cde2",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "UPDATE trials\nSET published_date = \"{{payload.discovery_date}}\"\n    \nWHERE\n    trial_id = {{payload.trial_id}};",
        "output": "str",
        "x": 680,
        "y": 500,
        "wires": [
            [
                "5cc55f5e649cf407",
                "68d7878fc0a5c894"
            ]
        ]
    },
    {
        "id": "37091faefc948117",
        "type": "split",
        "z": "73dc69858609cde2",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 550,
        "y": 500,
        "wires": [
            [
                "dac10b58551da14c"
            ]
        ]
    },
    {
        "id": "68d7878fc0a5c894",
        "type": "sqlite",
        "z": "73dc69858609cde2",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 890,
        "y": 500,
        "wires": [
            [
                "5cc55f5e649cf407"
            ]
        ]
    },
    {
        "id": "a8ebb947b8f2e0ba",
        "type": "inject",
        "z": "73dc69858609cde2",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 140,
        "y": 720,
        "wires": [
            [
                "a1a2bd110c70c860"
            ]
        ]
    },
    {
        "id": "a1a2bd110c70c860",
        "type": "sqlite",
        "z": "73dc69858609cde2",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "fixed",
        "sql": "select article_id,discovery_date from articles where published_date = '';",
        "name": "",
        "x": 320,
        "y": 720,
        "wires": [
            [
                "1cd7045e51628575"
            ]
        ]
    },
    {
        "id": "076c83dbf5890312",
        "type": "debug",
        "z": "73dc69858609cde2",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 970,
        "y": 780,
        "wires": []
    },
    {
        "id": "1cd7045e51628575",
        "type": "split",
        "z": "73dc69858609cde2",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 490,
        "y": 720,
        "wires": [
            [
                "aa296140b5a6d984"
            ]
        ]
    },
    {
        "id": "aa296140b5a6d984",
        "type": "template",
        "z": "73dc69858609cde2",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "UPDATE articles\nSET published_date = \"{{payload.discovery_date}}\"\n    \nWHERE\n    article_id = {{payload.article_id}};",
        "output": "str",
        "x": 620,
        "y": 720,
        "wires": [
            [
                "076c83dbf5890312",
                "3cfbce3447b60f03"
            ]
        ]
    },
    {
        "id": "3cfbce3447b60f03",
        "type": "sqlite",
        "z": "73dc69858609cde2",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 890,
        "y": 720,
        "wires": [
            [
                "076c83dbf5890312"
            ]
        ]
    },
    {
        "id": "4fa361a894cd1c86",
        "type": "inject",
        "z": "73dc69858609cde2",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 960,
        "wires": [
            [
                "9b25d44f0da4663c"
            ]
        ]
    },
    {
        "id": "9b25d44f0da4663c",
        "type": "sqlite",
        "z": "73dc69858609cde2",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "fixed",
        "sql": "SELECT * FROM  \"articles\" WHERE \"published_date\" LIKE '%Wed Dec 15 2%' ORDER BY \"article_id\"  ;",
        "name": "",
        "x": 300,
        "y": 960,
        "wires": [
            [
                "791fe1f3446e64a5"
            ]
        ]
    },
    {
        "id": "791fe1f3446e64a5",
        "type": "split",
        "z": "73dc69858609cde2",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 470,
        "y": 960,
        "wires": [
            [
                "335196ee587790ed",
                "14708325fe40518a"
            ]
        ]
    },
    {
        "id": "335196ee587790ed",
        "type": "template",
        "z": "73dc69858609cde2",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "UPDATE articles\nSET published_date = \"{{payload.discovery_date}}\"\n    \nWHERE\n    article_id = {{payload.article_id}};",
        "output": "str",
        "x": 660,
        "y": 920,
        "wires": [
            [
                "14708325fe40518a"
            ]
        ]
    },
    {
        "id": "14708325fe40518a",
        "type": "debug",
        "z": "73dc69858609cde2",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 930,
        "y": 1020,
        "wires": []
    },
    {
        "id": "2aae130e7eac9498",
        "type": "sqlite",
        "z": "73dc69858609cde2",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 930,
        "y": 940,
        "wires": [
            [
                "14708325fe40518a"
            ]
        ]
    },
    {
        "id": "2878de0777df24fd",
        "type": "comment",
        "z": "73dc69858609cde2",
        "name": "helpers to migrate to Postgres",
        "info": "",
        "x": 150,
        "y": 400,
        "wires": []
    },
    {
        "id": "0fdc482676b45961",
        "type": "http in",
        "z": "27add5de02c88e84",
        "name": "",
        "url": "/contact",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 120,
        "y": 60,
        "wires": [
            [
                "f6c934b7d92ce89f",
                "7a7f6a42e62909a8"
            ]
        ]
    },
    {
        "id": "f6c934b7d92ce89f",
        "type": "debug",
        "z": "27add5de02c88e84",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 220,
        "wires": []
    },
    {
        "id": "7a7f6a42e62909a8",
        "type": "http response",
        "z": "27add5de02c88e84",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 380,
        "y": 60,
        "wires": []
    },
    {
        "id": "1f4433c0def6a3d2",
        "type": "inject",
        "z": "ab2553788bcfd4e4",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "43200",
        "crontab": "",
        "once": true,
        "onceDelay": "1800",
        "topic": "",
        "payload": "DELETE FROM rel_articles_categories ;",
        "payloadType": "str",
        "x": 110,
        "y": 80,
        "wires": [
            [
                "c6843dba51f369fc"
            ]
        ]
    },
    {
        "id": "3d81f45d19a78207",
        "type": "template",
        "z": "ab2553788bcfd4e4",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "sql",
        "syntax": "mustache",
        "template": "{{#payload}}\nINSERT INTO rel_articles_categories (article_id, category_id) select articles.article_id,categories.category_id from categories inner join articles on articles.title like '%{{category_name}}%' and categories.category_name like '%{{category_name}}%' group by articles.article_id;\n{{/payload}}\n",
        "output": "str",
        "x": 420,
        "y": 220,
        "wires": [
            [
                "d21cad6f55ca9e5a"
            ]
        ]
    },
    {
        "id": "e2fef85a349544d2",
        "type": "debug",
        "z": "ab2553788bcfd4e4",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 730,
        "y": 220,
        "wires": []
    },
    {
        "id": "6260548a34e443b1",
        "type": "delay",
        "z": "ab2553788bcfd4e4",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 120,
        "y": 140,
        "wires": [
            [
                "4ab2dcf4bd542ef4"
            ]
        ]
    },
    {
        "id": "42cf521e59ec1235",
        "type": "split",
        "z": "ab2553788bcfd4e4",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 110,
        "y": 220,
        "wires": [
            [
                "d5cb3705c4f20e36"
            ]
        ]
    },
    {
        "id": "d5cb3705c4f20e36",
        "type": "delay",
        "z": "ab2553788bcfd4e4",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "3",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 260,
        "y": 220,
        "wires": [
            [
                "3d81f45d19a78207"
            ]
        ]
    },
    {
        "id": "c6843dba51f369fc",
        "type": "postgres",
        "z": "ab2553788bcfd4e4",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 430,
        "y": 80,
        "wires": [
            [
                "6260548a34e443b1"
            ]
        ]
    },
    {
        "id": "4ab2dcf4bd542ef4",
        "type": "change",
        "z": "ab2553788bcfd4e4",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": " select category_name,category_id from categories;",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 140,
        "wires": [
            [
                "94a0d32a228c6304"
            ]
        ]
    },
    {
        "id": "94a0d32a228c6304",
        "type": "postgres",
        "z": "ab2553788bcfd4e4",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 480,
        "y": 140,
        "wires": [
            [
                "42cf521e59ec1235"
            ]
        ]
    },
    {
        "id": "d21cad6f55ca9e5a",
        "type": "postgres",
        "z": "ab2553788bcfd4e4",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": true,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": true,
        "x": 580,
        "y": 220,
        "wires": [
            [
                "e2fef85a349544d2"
            ]
        ]
    },
    {
        "id": "d9d649b557d10771",
        "type": "http request",
        "z": "b86ce62c06906565",
        "name": "journals.sagepub",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://journals.sagepub.com/action/doSearch?AllField=multiple+sclerosis&SeriesKey=msja&content=articlesChapters&countTerms=true&target=default&sortBy=Ppub&startPage=&ContentItemType=research-article",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "senderr": false,
        "x": 350,
        "y": 80,
        "wires": [
            [
                "2d26aabd19e46970",
                "4b6c3e9e170e37ea"
            ]
        ]
    },
    {
        "id": "3ce9b540da30b614",
        "type": "inject",
        "z": "b86ce62c06906565",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "source",
                "v": "9",
                "vt": "num"
            }
        ],
        "repeat": "12000",
        "crontab": "",
        "once": true,
        "onceDelay": "99",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 80,
        "wires": [
            [
                "d9d649b557d10771"
            ]
        ]
    },
    {
        "id": "fe1747c821af436b",
        "type": "split",
        "z": "b86ce62c06906565",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "article.key",
        "x": 790,
        "y": 80,
        "wires": [
            [
                "cdb2d4ef2deb6787"
            ]
        ]
    },
    {
        "id": "cdb2d4ef2deb6787",
        "type": "change",
        "z": "b86ce62c06906565",
        "name": "set source SagePub",
        "rules": [
            {
                "t": "set",
                "p": "article",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article.url",
                "pt": "msg",
                "to": "\"https://journals.sagepub.com\" & payload.link",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "article.source",
                "pt": "msg",
                "to": "Sage Pub",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "article.description",
                "pt": "msg",
                "to": "not available",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "article.title",
                "pt": "msg",
                "to": "$trim(article.title)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.pubdate",
                "pt": "msg",
                "to": "$split($trim($replace(article.pubdate, \", First Published \", \" \")),\".\",1)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 960,
        "y": 80,
        "wires": [
            [
                "7ebc76ff78b0ed0a"
            ]
        ]
    },
    {
        "id": "7ebc76ff78b0ed0a",
        "type": "change",
        "z": "b86ce62c06906565",
        "name": "fix pubdate",
        "rules": [
            {
                "t": "set",
                "p": "payload.pubdate",
                "pt": "msg",
                "to": "$replace($replace(payload.pubdate[0],\" \", \"-\"),\",\",\"\")",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1150,
        "y": 80,
        "wires": [
            [
                "9ef74ad7d2efd2c5"
            ]
        ]
    },
    {
        "id": "2fa83b34fe97062f",
        "type": "subflow:acf883d8.84eea",
        "z": "b86ce62c06906565",
        "name": "Insert SQL",
        "env": [],
        "x": 810,
        "y": 180,
        "wires": [
            [
                "1824593762bc0e59",
                "f86a1ec2f72306b7"
            ]
        ]
    },
    {
        "id": "2d26aabd19e46970",
        "type": "cheerio",
        "z": "b86ce62c06906565",
        "name": "",
        "tag": ".searchResultItem",
        "ret": "object",
        "as": "single",
        "map": [
            {
                "search": "h2",
                "ret": "text",
                "replace": "title",
                "attr": ""
            },
            {
                "search": "h2>span>a",
                "ret": "attribute",
                "replace": "link",
                "attr": "href"
            },
            {
                "search": "div.hlFld-Abstract.preview-abstract",
                "ret": "text",
                "replace": "description",
                "attr": ""
            },
            {
                "search": "span.publication-meta",
                "ret": "text",
                "replace": "pubdate",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": true,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 570,
        "y": 80,
        "wires": [
            [
                "fe1747c821af436b",
                "4b6c3e9e170e37ea"
            ]
        ]
    },
    {
        "id": "9ef74ad7d2efd2c5",
        "type": "moment",
        "z": "b86ce62c06906565",
        "name": "format pubdate",
        "topic": "",
        "input": "payload.pubdate",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": 0,
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "en-US",
        "output": "article.pubdate",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 640,
        "y": 180,
        "wires": [
            [
                "2fa83b34fe97062f"
            ]
        ]
    },
    {
        "id": "636814b1a66060a9",
        "type": "subflow:822a1abe384d181e",
        "z": "b86ce62c06906565",
        "name": "",
        "x": 1450,
        "y": 300,
        "wires": [
            [
                "d6e894e01c01a60d"
            ]
        ]
    },
    {
        "id": "d6e894e01c01a60d",
        "type": "debug",
        "z": "b86ce62c06906565",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1740,
        "y": 340,
        "wires": []
    },
    {
        "id": "e804c73811e4a00f",
        "type": "comment",
        "z": "b86ce62c06906565",
        "name": "ADD SAGEPUB SUMMARY",
        "info": "",
        "x": 200,
        "y": 240,
        "wires": []
    },
    {
        "id": "e8b0bcc933a0a25b",
        "type": "split",
        "z": "b86ce62c06906565",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 540,
        "y": 280,
        "wires": [
            [
                "8ac915a7fea20ed7"
            ]
        ]
    },
    {
        "id": "dc9c9507dc1a5636",
        "type": "http request",
        "z": "b86ce62c06906565",
        "name": "SAGEPUB",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "e3876559.c845b8",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 860,
        "y": 320,
        "wires": [
            [
                "f3d0d5b970850bd7"
            ]
        ]
    },
    {
        "id": "e9127979d212e6f4",
        "type": "change",
        "z": "b86ce62c06906565",
        "name": "set fields",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "payload.link",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "article_id",
                "pt": "msg",
                "to": "payload.article_id",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 320,
        "wires": [
            [
                "dc9c9507dc1a5636"
            ]
        ]
    },
    {
        "id": "2a796f8004890512",
        "type": "template",
        "z": "b86ce62c06906565",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "UPDATE articles\nset summary = \"{{{payload.summary}}}\"\nwhere article_id = {{article_id}};",
        "output": "str",
        "x": 1130,
        "y": 320,
        "wires": [
            [
                "636814b1a66060a9"
            ]
        ]
    },
    {
        "id": "0f5e3c4bfdc9df1c",
        "type": "inject",
        "z": "b86ce62c06906565",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "7200",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 140,
        "y": 360,
        "wires": [
            [
                "bf70227a598274c8"
            ]
        ]
    },
    {
        "id": "8ac915a7fea20ed7",
        "type": "delay",
        "z": "b86ce62c06906565",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "30",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 530,
        "y": 340,
        "wires": [
            [
                "e9127979d212e6f4"
            ]
        ]
    },
    {
        "id": "f3d0d5b970850bd7",
        "type": "cheerio",
        "z": "b86ce62c06906565",
        "name": "",
        "tag": "body",
        "ret": "object",
        "as": "multi",
        "map": [
            {
                "search": "div.hlFld-Abstract",
                "ret": "text",
                "replace": "summary",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": false,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 1000,
        "y": 320,
        "wires": [
            [
                "2a796f8004890512"
            ]
        ]
    },
    {
        "id": "bf70227a598274c8",
        "type": "sqlite",
        "z": "b86ce62c06906565",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "fixed",
        "sql": "SELECT * FROM articles \nWHERE source = \"Sage Pub\" \nAND summary =\"not available\";",
        "name": "",
        "x": 380,
        "y": 280,
        "wires": [
            [
                "e8b0bcc933a0a25b"
            ]
        ]
    },
    {
        "id": "2e929cc9a8721fe1",
        "type": "debug",
        "z": "b86ce62c06906565",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "article_id",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 800,
        "y": 700,
        "wires": []
    },
    {
        "id": "ad30093742a3f4e7",
        "type": "sqlite",
        "z": "b86ce62c06906565",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "fixed",
        "sql": "select article_id,link from articles where source = \"Sage Pub\" and published_date = \"\" limit 1;",
        "name": "",
        "x": 350,
        "y": 540,
        "wires": [
            [
                "5676e3ac9177ad4b"
            ]
        ]
    },
    {
        "id": "5676e3ac9177ad4b",
        "type": "change",
        "z": "b86ce62c06906565",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "article_id",
                "pt": "msg",
                "to": "payload[0].article_id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0].link",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 540,
        "y": 540,
        "wires": [
            [
                "dad9e32dbb540021"
            ]
        ]
    },
    {
        "id": "3eeda7a8a3aac7a9",
        "type": "sqlite",
        "z": "b86ce62c06906565",
        "mydb": "9ccc1658.e12858",
        "sqlquery": "msg.topic",
        "sql": "",
        "name": "",
        "x": 590,
        "y": 700,
        "wires": [
            [
                "2e929cc9a8721fe1"
            ]
        ]
    },
    {
        "id": "caada881b7c7dfa9",
        "type": "comment",
        "z": "b86ce62c06906565",
        "name": "populate missing values of published date not working",
        "info": "",
        "x": 310,
        "y": 480,
        "wires": []
    },
    {
        "id": "dad9e32dbb540021",
        "type": "http request",
        "z": "b86ce62c06906565",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": false,
        "url": "",
        "persist": false,
        "authType": "",
        "senderr": false,
        "x": 130,
        "y": 620,
        "wires": [
            [
                "ec8f71035f5551b8"
            ]
        ]
    },
    {
        "id": "ec8f71035f5551b8",
        "type": "cheerio",
        "z": "b86ce62c06906565",
        "name": "",
        "tag": ".publicationContentEpubDate.dates",
        "ret": "html",
        "as": "single",
        "map": [
            {
                "search": "",
                "ret": "html",
                "replace": "",
                "attr": ""
            }
        ],
        "xmlMode": false,
        "decodeEntities": false,
        "lowerCaseTags": false,
        "lowerCaseAttributeNames": false,
        "recognizeCDATA": false,
        "recognizeSelfClosing": false,
        "x": 390,
        "y": 620,
        "wires": [
            [
                "e7b46a42906e8062"
            ]
        ]
    },
    {
        "id": "e7b46a42906e8062",
        "type": "string",
        "z": "b86ce62c06906565",
        "name": "",
        "methods": [
            {
                "name": "trim",
                "params": []
            },
            {
                "name": "delLeftMost",
                "params": [
                    {
                        "type": "str",
                        "value": "<b>First Published </b> "
                    }
                ]
            }
        ],
        "prop": "payload[0]",
        "propout": "payload",
        "object": "msg",
        "objectout": "msg",
        "x": 610,
        "y": 620,
        "wires": [
            [
                "a3d88ffb176d599b",
                "f86a1ec2f72306b7"
            ]
        ]
    },
    {
        "id": "a3d88ffb176d599b",
        "type": "moment",
        "z": "b86ce62c06906565",
        "name": "",
        "topic": "",
        "input": "payload",
        "inputType": "msg",
        "inTz": "Europe/Lisbon",
        "adjAmount": "1",
        "adjType": "days",
        "adjDir": "add",
        "format": "",
        "locale": "POSIX",
        "output": "",
        "outputType": "msg",
        "outTz": "Europe/Lisbon",
        "x": 180,
        "y": 700,
        "wires": [
            [
                "7b754cb89275c3dd"
            ]
        ]
    },
    {
        "id": "7b754cb89275c3dd",
        "type": "template",
        "z": "b86ce62c06906565",
        "name": "",
        "field": "topic",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "update articles set published_date ='{{payload}}' where article_id  = {{article_id}};",
        "output": "str",
        "x": 380,
        "y": 700,
        "wires": [
            [
                "3eeda7a8a3aac7a9"
            ]
        ]
    },
    {
        "id": "f86a1ec2f72306b7",
        "type": "debug",
        "z": "b86ce62c06906565",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 810,
        "y": 540,
        "wires": []
    },
    {
        "id": "1824593762bc0e59",
        "type": "postgres",
        "z": "b86ce62c06906565",
        "postgresdb": "168f4567fd86d95c",
        "name": "",
        "output": false,
        "perrow": false,
        "rowspermsg": "1",
        "return_on_error": false,
        "limit_queries": "0",
        "limit_by": "payload",
        "limit_value": "1",
        "limit_drop_intermediate": false,
        "limit_drop_if_in_queue": false,
        "outputs": false,
        "x": 1060,
        "y": 220,
        "wires": []
    },
    {
        "id": "4b6c3e9e170e37ea",
        "type": "debug",
        "z": "b86ce62c06906565",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 460,
        "y": 200,
        "wires": []
    }
]